<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/github-markdown.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="all">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://girigiribauer.com/index.xml">
    <title>CLI - ばうあーろぐ</title>
    <meta property="og:title" content="CLI - ばうあーろぐ">
    <meta property="og:type" content="article">
    <meta name="description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:url" content="http://girigiribauer.com/tags/cli/">
    <meta property="fb:app_id" content="396423247105258">
    <meta property="og:image" content="http://girigiribauer.com/img/ogimage.png">
<meta name="generator" content="Hugo 0.17" />
  </head>
  <body>

<div class="markdown-body">
<header>
<a href="/">ばうあーろぐ TOP へ戻る</a>
</header>


<div class="maincontents">

<h1>Tags / CLI</h1>

<div class="poststatus">
  <p>  <time datetime="2017年2月8日">2017年2月8日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
    <li class="flow"><a href="/tags/shellscript/">ShellScript</a></li>
  </ul>
</div>




<p>その場で展開したいのです。</p>

<p>結論から先に書いておきます。</p>

<pre><code>function print_date() {
  zle -U `date &quot;+%y%m%d&quot;`
}
zle -N print_date
bindkey &quot;^Xd&quot; print_date
</code></pre>

<p>zsh における入力バッファの概念だとか、 zle (zsh line editor) だとか、
その辺が少し分かっていなかったので、ちょっとだけ試行錯誤してました。</p>

<p>せっかくなのでメモしておきます。</p>

<h2 id="当初の入力補助する案">当初の入力補助する案</h2>

<p>当初考えたのがこちら。頭空っぽで書きました。</p>

<pre><code>function print_date() {
  echo -n `date &quot;+%y%m%d&quot;`
}
bindkey &quot;^Xd&quot; print_date
</code></pre>

<p><code>bindkey</code> コマンドで現在割り当ててあるキーマップの一覧が確認できるので、
空いてそうな <strong>Ctrl-X -&gt; D</strong> キーを割り当てることにしました。date の D です。</p>

<p>そして .zshrc に反映して実行してみます。</p>

<pre><code>% 170208
</code></pre>

<p>表示されましたが、ここで違和感が。
<strong>Ctrl-W で消えません。</strong></p>

<p>あれ？おかしい・・・？と思い、<code>mkdir</code> のあとに実行して 日付のディレクトリを作ってみることに。</p>

<pre><code>% mkdir 170208
mkdir: missing operand
Try 'mkdir --help' for more information.
</code></pre>

<p><strong>missing operand</strong> と表示されここで初めて気づきます。</p>

<p><strong>あー、これ単に出力されてるだけか、と。</strong></p>

<p>ここでようやく <strong>マニュアル読まないと、</strong> となりました。</p>

<h2 id="man-zshzle-を読む">man zshzle を読む</h2>

<p>zsh に関するマニュアルはいくつかに分割されています。</p>

<p>man zsh を引用します。</p>

<pre><code>OVERVIEW
       Because zsh contains many features, the zsh manual has been split into a number of sections:

       zsh          Zsh overview (this section)
       zshroadmap   Informal introduction to the manual
       zshmisc      Anything not fitting into the other sections
       zshexpn      Zsh command and parameter expansion
       zshparam     Zsh parameters
       zshoptions   Zsh options
       zshbuiltins  Zsh built-in functions
       zshzle       Zsh command line editing
       zshcompwid   Zsh completion widgets
       zshcompsys   Zsh completion system
       zshcompctl   Zsh completion control
       zshmodules   Zsh loadable modules
       zshcalsys    Zsh built-in calendar functions
       zshtcpsys    Zsh built-in TCP functions
       zshzftpsys   Zsh built-in FTP client
       zshcontrib   Additional zsh functions and utilities
       zshall       Meta-man page containing all of the above
</code></pre>

<p>マニュアルが分割されているとありますね。</p>

<p>この中で、今回の入力バッファなどの編集については、
<strong>zsh command line editor (zle)</strong> が相当します。
なので zshzle を読みましょう。</p>

<pre><code>man zshzle
</code></pre>

<p>ずらっと読んでいくと、 ZLE BUILTINS の中の zle コマンドのところにこんなオプションがあります。</p>

<pre><code>-U string
       This  pushes the characters in the string onto the input stack of ZLE.  After the
       widget currently executed finishes ZLE will behave as if the  characters  in  the
       string were typed by the user.
</code></pre>

<p>大まか -U の後の文字列を追加することは分かったのですが、
<strong>ん？ widget ってなんです？</strong></p>

<p>何やら知らない概念があるらしいので、もうちょっと掘り下げてみます。</p>

<p>最初の方に戻ってさらっと読むと、 <strong>Widgets セクションがあるから読んでみて</strong>
とあるのでそちらを探してみます。</p>

<p>・・・。</p>

<p>細かく説明してると手間なので、詳しくは気になる人がそれぞれ実際に読めば良いと思うのですが、
ざっと紹介するとこんな感じです。</p>

<p>zle には widget という概念が存在しており、
builtin で用意された widget とユーザーが独自に定義した widget とを
同じように扱うことができるようです。</p>

<p><strong>関数をキーバインドで呼び出すのではなく、
widget を呼び出す</strong> のが zsh の流儀のようです。</p>

<p>さらに <code>zle -N</code> の説明が書いてあるところを読むと、</p>

<pre><code>-N widget [ function ]
       Create  a  user-defined  widget.  If there is already a widget with the specified
       name, it is overwritten.  When the new widget is invoked from within the  editor,
       the  specified  shell  function  is called.  If no function name is specified, it
       defaults to the same name as the widget.  For further information, see  the  sec-
       tion `Widgets' below.
</code></pre>

<p>これでユーザー定義の widget が登録できるので、
キーバインドを設定する前に、まずは widget を登録します。</p>

<p>ちなみに、用意した引数が widget 分しかなかった場合は、
<strong>同じ名前で function 名がある前提で登録をしてくれるようです。</strong>
合わせておくと管理上分かりやすいので名前を同じにしておきます。</p>

<p>ちょっと分かりづらくなってきたので、まとめるとこんな感じです。</p>

<ol>
<li>ユーザー定義の関数を用意する</li>
<li>その関数を <strong>widget として登録する (zle -N)</strong></li>
<li>widget を <strong>キーバインドで呼び出す (bindkey)</strong></li>
</ol>

<p>この流れですね。</p>

<p>以上を踏まえて書き直したのがこちら。</p>

<pre><code>function print_date() {
  zle -U `date &quot;+%y%m%d&quot;`
}
zle -N print_date
bindkey &quot;^Xd&quot; print_date
</code></pre>

<p>これで正しく動作しました。</p>

<p>キーバインドで日付が入力できるようにしておくと、
汎用的に利用ができるので良いと思います。</p>

<h2 id="まとめ">まとめ</h2>

<p>いつも同じ結論ですが、<strong>マニュアルはきちんと読みましょう。</strong></p>

<p>そのコマンドなりアプリなりを作ってくれた人は、
<strong>その開発に割いた時間に加えて、ヘルプなりドキュメントなりを書いてくれているのです。
もう本当に感謝しかありません。</strong></p>

<p>逆にマニュアル読まずにググってばかりの人は、
これを機に <strong>マニュアルを読む癖</strong> をつけた方が良いと思います。
書いてくれた人のためにもね。</p>

<p>僕は感謝しながらマニュアルを読みつつ、
感謝をこめてブログにメモしようと思いました。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2017年2月8日">2017年2月8日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
    <li class="flow"><a href="/tags/shellscript/">ShellScript</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2017年1月22日">2017年1月22日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/tmux/">tmux</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>


<p>tmux の自動起動周りに少し不満があって、
zshrc に以下の記述を追加しました。</p>

<pre><code># 初期に用意されているセッション
# &quot;prefix -&gt; (&quot; or &quot;prefix -&gt; )&quot; でセッション切り替え
TMUX_INITIAL_SESSIONS=(
&quot;config&quot;
&quot;works&quot;
&quot;personal&quot;
)

# 初期セッションが存在していなかったらバックグラウンドで作る
for tmux_session in ${TMUX_INITIAL_SESSIONS[@]}
do
  if ! $(tmux has-session -t ${tmux_session} 2&gt; /dev/null)
  then
    tmux new-session -d -s ${tmux_session}
  fi
done

# tmux が起動中でなければ attach する
if [ -z &quot;$TMUX&quot; ]
then
  tmux attach-session -t &quot;${TMUX_INITIAL_SESSIONS[0]}&quot;
else
fi
</code></pre>

<p>基本的に書いてある通りなのですが、
自分であらかじめ用意したいセッションを変数（TMUX_INITIAL_SESSIONS）に入れておきます。
別に他の名前でも良いです。</p>

<pre><code>TMUX_INITIAL_SESSIONS=(
&quot;mysession1&quot;
&quot;mysession2&quot;
&quot;mysession3&quot;
)
</code></pre>

<p>シェルが立ち上がるたびに、そのセッションがなければバックグラウンドで作ります。</p>

<pre><code>if ! $(tmux has-session -t ${tmux_session} 2&gt; /dev/null)
then
  tmux new-session -d -s ${tmux_session}
fi
</code></pre>

<p>これで常に TMUX_INITIAL_SESSIONS にある名前のセッションは存在していることになるので、
TMUX 変数に何らかセットされていない場合に限って attach すれば良いことになります。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2017年1月22日">2017年1月22日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/tmux/">tmux</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2017年1月14日">2017年1月14日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
  </ul>
</div>




<p>今でこそ iTerm2 を全面に表示して、
tmux でセッション、ウィンドウ、ペインごとに分けて、
ターミナル内の Vim であれこれやってるわけですが、
始めたての頃はコマンドラインに慣れるまで大変でした。</p>

<p>今振り返って、これを知ってから or 使うようになってから、
劇的に変わったなあと思うようなものがあるので、
それらをメモ代わりに残しておきます。</p>

<p><strong>今年からターミナルを使いこなしたい！</strong> と思っている方におすすめします。</p>

<h2 id="emacs-vi-両方のキーバインドを最低限知っておく">Emacs, Vi 両方のキーバインドを最低限知っておく</h2>

<p>これはエディタの話ではなく、コマンドラインであれこれやるにあたって
<strong>両方のキーバインドを最低限知っておく必要があった</strong> という意味です。</p>

<p>僕の環境設定の考え方の話になるのですが、
なんでもかんでも自分の使いやすいように変えていくのではなく、
<strong>よくある標準の設定をベースにしつつ、より良い設定を邪魔せず上乗せしていく形</strong>
を取りたいといつも思っています。</p>

<p>コマンドラインを使っていくに従って、
<strong>標準の設定というのがとても良く考えられていることに段々気づいていく</strong> と思います。</p>

<p>当然なのですが、その標準の設定を考えた人というのがいるわけで、
すべてのことには理由があるので、
仮にその理由を知らなかったとしても
その標準の設定に合わせることで
<strong>自然とそのメリットを享受できる</strong> ことも出てきます。</p>

<h3 id="シェルスクリプトはもともと-emacs-風">シェルスクリプトはもともと Emacs 風</h3>

<p>bash や zsh などのシェルでは、キーバインドのモードを切り替える設定が用意されています。</p>

<pre><code># bash
set -o vi

# zsh
bindkey -v
</code></pre>

<p>上記はともに Vi モードに切り替える設定なのですが、
設定を変更しない場合、 <strong>標準で Emacs 風</strong> になっています。</p>

<p>ここで仮に Ctrl-a で行頭に移動、 Ctrl-e で行末に移動、 Ctrl-w で1単語分の削除、
などの Emacs 上での操作を知っていると、
<strong>何も設定していないターミナル上で Emacs 風キーバインドで操作できる</strong> ことになります。</p>

<p>コマンドライン使いたての頃、比較的長めのコマンドを打って実行したらミスが見つかったけど、
その直したい箇所が入力の頭の方で、
左キーを連打しまくってるけど時間がかかってしょうがない、みたいなケース、
よくある話ではないでしょうか？</p>

<p>特に何も設定されていないサーバなどに始めてアクセスする際には、
こういったキーバインドを知っていることが効率に直結することもあると思います。</p>

<h3 id="未知の端末をなんとなく扱えるメリットも">未知の端末をなんとなく扱えるメリットも</h3>

<p>Windows の方はメリットを享受できないのですが、
Mac の方は command キーと control キーに分かれているため、
上記の Ctrl-a, Ctrl-e などのキーバインドが他アプリケーションで使えたりします。</p>

<p>例えば <strong>各種 Web ブラウザの URL バー</strong> などはすでにそういった想定がされています。
長い URL を入力しているとき、http じゃなくて https だったとなったときに
マウスに手を伸ばす必要はありません。 Ctrl-a を押しましょう。</p>

<p>Windows だと全選択が Ctrl-a などで重複してしまっており、Emacs 風のものは割り当てられていないようですね。</p>

<h3 id="マニュアルを読むときは-vi-風">マニュアルを読むときは Vi 風</h3>

<p>一方でマニュアルを読む際は <strong>最低限の Vi のキーバインド</strong> を知っておく必要があります。
こちらもエディタとして使えるようになる必要はなく、
<strong>上下の移動、検索あたりができれば必要十分</strong> だと思います。</p>

<p>そもそも、</p>

<pre><code>man foobar

foobar --help
</code></pre>

<p>といったマニュアルを読む際は、
Ctrl-f(forward), Ctrl-d(down) で下スクロール、
Ctrl-b(back), Ctrl-u(up) で上スクロールでき、
/ キーのあとにキーワードを入力して Enter キーを押せば検索できます。</p>

<p>これらのキーバインドは Vi から来ています。</p>

<h3 id="インターフェースとしての-emacs-vi">インターフェースとしての Emacs, Vi</h3>

<p><strong>インターフェース</strong> という言葉が一番しっくりきます。</p>

<p>エディタの操作方法としてではなく、
インターフェースとして最低限知っておくだけで
ターミナル上のコマンドライン操作はだいぶ変わってくると思います。</p>

<p>自分が UI 実装する側になったときに、キーボード入力が想定されるのであれば、
こういったところにも配慮すると、より使いやすくなるかもしれません。</p>

<h2 id="コマンド履歴を使う">コマンド履歴を使う</h2>

<p>そもそも最初はコマンド履歴を知らなかったので、
上キーを押すことで過去に押したコマンドが表示されることも知りませんでした。</p>

<p>それを知ってるかどうかだけでも少し変わってくるのですが、
<strong>インクリメンタルサーチをきちんと使いこなす</strong> だけで大きく効率が変わってきます。</p>

<p>これ知ったのつい2年前ほどだったのですが、 <a href="http://girigiribauer.com/archives/1873/" target="_blank">http://girigiribauer.com/archives/1873/</a>
それまで知らなかった自分に愕然としましたね。</p>

<p>特にサブコマンドやオプションの多い長いコマンドを、ある程度断続的に入力するケースの場合、
<strong>インクリメンタルサーチはおすすめです。</strong></p>

<p>こちらも設定なしで、 <strong>Ctrl-r</strong> が割り当てられています。</p>

<p>一度入力する前に任意のコマンドを入力しておきます。（なんでもいいです）</p>

<pre><code>% sudo service httpd restart
</code></pre>

<p>何も入力していない状態で、Ctrl-r を押すと、</p>

<pre><code>%
bck-i-search: _
</code></pre>

<p>入力箇所の下に bck-i-search という表示が出ます。
<strong>後ろ方向のインクリメンタルサーチ</strong> のことです。</p>

<p>ここで http と順に打つと、 <strong>他に候補がない時点で先ほど入力したコマンドが表示されます。</strong></p>

<pre><code>% sudo service httpd restart
bck-i-search: httpd\_
</code></pre>

<p>もし候補が出たけどもっと過去の履歴が欲しい！となったときは、
後ろ方向のインクリメンタルサーチなので、何回か Ctrl-r を押しましょう。
その都度、履歴を過去方向に検索してくれます。</p>

<p>ちなみに遡りすぎた場合は、 <strong>前方向のインクリメンタルサーチである Ctrl-s</strong> も用意されています。
そちらで今度は過去方向から未来方向へインクリメンタルサーチしましょう。</p>

<pre><code>%
fwd-i-search: _
</code></pre>

<h3 id="オプション付きの長いコマンドを何回かおきに入力するケースなどに有効">オプション付きの長いコマンドを何回かおきに入力するケースなどに有効</h3>

<p>最近だと Docker を使ったりする方も増えてきていると思います。</p>

<pre><code>docker run -d -p 80 -v &quot;$(pwd)/public:/usr/share/nginx/html&quot; --name test nginx
</code></pre>

<p>まだこれくらいならかわいいもので、追加でボリュームを紐付けたり、環境変数を設定したりすると、
2行3行と長くなってきます。</p>

<p>毎回同じコマンドを入力するだけなら、上キーだけで十分なのですが、
間に別のコマンドを何度か入力したりして、間がどんどん開いてくると、
上キーだけで遡るのは厳しくなってきます。</p>

<p>上記の例であれば、例えば <strong>Ctrl-r を押した後に docker と入力した方が直感的だし速い</strong> です。
場合によっては docker 全部入力せずに d だけで事足りるかもしれません。（インクリメンタルサーチなので）</p>

<p>僕の場合ですが、 tmux を利用して画面を分割してコマンド入力を色々行っており、
こっちの画面で過去に入力したコマンドを、今度はあっちの画面で入力したい、
みたいなケースがけっこう出て来ます。
そういったケースに対応するために、 .zshrc に履歴の共有を行う設定を入れています。</p>

<h2 id="tab-キーによるコマンド補完を使う">Tab キーによるコマンド補完を使う</h2>

<p>あとは当然知ってる話だと思うのでおまけ程度ですが、
<strong>コマンド打つときは Tab キーで補完できる</strong> ことは知っておきましょう。</p>

<p>さすがに自分はなかったですが、
たまに律儀に毎回全部入力している人を見ると「うーん・・・」という気分になります。</p>

<h2 id="まとめ">まとめ</h2>

<p>標準の設定をインターフェースとして捉えることで、
様々なメリットが享受できると思います。
<strong>あまりあれこれ設定をいじりすぎずに、標準の設定に慣れるということも一定大事</strong> だと思います。</p>

<p>慣れるまでは大変だと思いますが、
GUI ではカバーしきれないところをコマンドラインで出来ることも多いので、
頑張って慣れていくと良いと思います。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2017年1月14日">2017年1月14日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2017年1月3日">2017年1月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>あけましておめでとうございます。</p>

<p>書き初めとして書きました。</p>

<p>もともと1日かからない程度のものを書き初めとして書きたかったので、大きくずれはなかったです。</p>

<ul>
<li><a href="https://github.com/girigiribauer/go-pwgen" target="_blank">https://github.com/girigiribauer/go-pwgen</a></li>
</ul>

<h2 id="パスワード文字列を生成できるコマンドラインツール">パスワード文字列を生成できるコマンドラインツール</h2>

<p>まず先にやってないこととして、</p>

<ul>
<li><strong>パスワードの強度チェック</strong></li>
</ul>

<p>これを挙げておきます。</p>

<p>パスワード文字列を生成するにあたって、
当然セキュリティは一定担保する必要があったのですが、
かといってこの辺のパスワードの強度チェックをゼロから独自に研究するのは
無理がある＆仮に出来たとしても圧倒的に時間が足らないので、
外部のライブラリを利用しています。</p>

<p>パスワードの強度としては、例えば以下のようなケースが考えられます。</p>

<ul>
<li><strong>連続した同じ文字列</strong> （777 など）</li>
<li><strong>連続した順序を持った文字列</strong> （abc など）</li>
<li><strong>よくある英単語と一致する文字列</strong> や <strong>その逆順</strong></li>
<li><strong>キーボード上の順序を持った文字列</strong> （qwerty など）</li>
</ul>

<p>こういったチェックは学問、アルゴリズムの話になってきてしまい、個人では追いきれないため、
<strong>zxcvbn</strong> というライブラリを利用させてもらってます。</p>

<p><a href="https://github.com/dropbox/zxcvbn" target="_blank">https://github.com/dropbox/zxcvbn</a></p>

<p>提供しているのは Dropbox 社のようですが、 MIT ライセンスで誰でも利用できるようになっています。</p>

<p>実際のところ、上記の JavaScript 実装では新規アカウントを作るフォーム画面中において、
クライアントサイドでのパスワード強度チェックに用いられているようですね。</p>

<p>今回はそちらの Golang 実装を利用します。</p>

<p><a href="https://github.com/nbutton23/zxcvbn-go" target="_blank">https://github.com/nbutton23/zxcvbn-go</a></p>

<p>なお、ライブラリのページを見てもらえれば分かる話なのですが、
<strong>クラックされるまでのおおよその時間（crack_times_display）</strong>や
<strong>パスワード強度の5段階評価（score: 0 - 4）</strong> などの情報を利用することが出来ます。</p>

<p>アルゴリズムなどを追ってみるのも面白いかもしれませんね。</p>

<h3 id="今回の目的-目標">今回の目的、目標</h3>

<p>目的としてはこんな感じです。</p>

<ul>
<li>新年、ブログに目標書くくらいなら <strong>先に作るべき</strong></li>
<li><strong>Web 経由である必要がないもの</strong></li>
<li><strong>GUI である必要がないもの</strong></li>
</ul>

<p>1password を利用しているので、フォーム入力時には強度のあるパスワードが生成できるのですが、
そういった画面も何もないところでパスワードだけ生成したい場合に、
<strong>コマンドをちょっと入力するだけですぐ生成できると便利そう</strong> です。</p>

<p>その割には、毎回欲しいと思ったときに外部の Web サービスを利用しており、
ブックマークの整理をしている際に、
<strong>『これ Web じゃなくていいよなあ、 GUI じゃなくていいよなあ』</strong>
と思っていたところでした。</p>

<p>昨年の <a href="http://girigiribauer.com/archives/20161003/" target="_blank">Golang で DB が簡単に扱える自作コマンドを作ってみた</a>
で、Golang で自作コマンドはすでに作っていたので、
今回も同様に（素早く）作ってみようと思います。</p>

<h3 id="各種オプションと初期値">各種オプションと初期値</h3>

<p>基本的にマニュアル読めば全部書いてあるのですが、
パスワードの桁数は最低8文字ないと、パスワード強度のスコア的にセキュリティが確保できません。
（文字種が少ない、文字数が少ないなどのケースではスコアが 4 にならない）</p>

<p>逆に、桁数が多すぎたとしても今度は各種強度チェックに時間がかかってきてしまいます。</p>

<p>なので、 <strong>最小8文字、最大128文字、初期値を10文字</strong> とすることにしました。</p>

<p>また、文字種を以下のもので定義しました。</p>

<ul>
<li>数値（digit: 0-9）</li>
<li>アルファベット大文字（alphabetlarge: A-Z）</li>
<li>アルファベット小文字（alphabetsmall: a-z）</li>
<li>アンダースコア（underscore: _）</li>
<li>特殊記号（special characters: 制御文字など表示できない文字を除いたもの）</li>
</ul>

<p>よく使うのは数値、アルファベット大文字・小文字の文字種だと思うので、
これらをオプションなしで true になるように、
それ以外のものはオプション付きで明示することで true にできるようにしました。</p>

<p>表示個数ですが、個人的にはパッといくつか表示したうえで
最終的に自分で選んで利用したいので、
<strong>10個ほど初期で表示しつつ、個数の指定も上書きできるようにしました。</strong></p>

<p>あとこれ一番大事ですが、自分でキーボード打つのが面倒にならないようにするため、
コマンド名は一番分かりやすく <strong>pw</strong> で、
なおかつ <strong>オプションを一切何もつけない状態 = 一番自分の利用しやすい設定</strong>
となるようにオプションもろもろ考えました。</p>

<h2 id="作ってみた感想">作ってみた感想</h2>

<ul>
<li>package unicode の存在</li>
<li>ランダム性を含むユニットテストについて</li>
</ul>

<p>さっき気づいたのですが、
unicode というパッケージがあって ASCII 周りも定義されてるっぽいので
独自で定義せずにこの辺に乗っかっておくとひょっとすると楽出来たのでしょうか？
後で調べてみることにします。</p>

<p>あと、ランダムに生成する系のものって毎回テストのやり方に悩みますね・・・。</p>

<p>今回のケースだと、例えば実際にパスワード生成を行う関数とかがそうですかね。
文字数の長さと、構成文字以外の文字が入っていないかのチェックくらいですかねえ、うーん。</p>

<h2 id="まとめ">まとめ</h2>

<p>やろうと思ってから実際に出来るところまでが早い Golang は好きです。</p>

<p>やらなきゃと思ったことをすぐに行動に移せるようになりたいですね。
そういう意味でも、実際に書き初めする行動まで移せたことは幸先が良いと思います。
2017年頑張ります。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://github.com/dropbox/zxcvbn" target="_blank">https://github.com/dropbox/zxcvbn</a></li>
<li><a href="https://nulab-inc.com/ja/blog/nulab/password-strength/" target="_blank">https://nulab-inc.com/ja/blog/nulab/password-strength/</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2017年1月3日">2017年1月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年10月4日">2016年10月4日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/homebrew/">Homebrew</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>超楽だったのでメモっておきます。</p>

<p>こちらにドキュメントあります。（Golang のバイナリの場合ではないので少し異なりますが）</p>

<p><a href="https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md" target="_blank">https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md</a></p>

<h2 id="homebrew-対応">Homebrew 対応</h2>

<p>自作コマンド <a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a> を公開している時に
リリースバイナリまで GitHub に登録できて一息つけたーというタイミングで、
ふと <code>brew install db-cli</code> でインストールできたらいいなあと思ったので
調べてやってみたらさくっと1時間もかからずいけました。</p>

<p>自作コマンド用のリポジトリとは別に、</p>

<p><a href="https://github.com/girigiribauer/homebrew-db-cli" target="_blank">https://github.com/girigiribauer/homebrew-db-cli</a></p>

<p>という &ldquo;homebrew-&rdquo; プレフィックス付きの名前の Homebrew 用のリポジトリを用意し、Ruby ファイルを追加します。</p>

<p><code>brew create</code> コマンドでいけるようですが、
シンプルなので自分で用意しています。</p>

<pre><code>require 'formula'

REPOSITORY_URL='https://github.com/girigiribauer/db-cli'
HOMEBREW_DBCLI_VERSION='0.1.24'

class DbCli &lt; Formula
  desc '`db` command line tools (Docker based)'
  homepage REPOSITORY_URL
  url &quot;#{REPOSITORY_URL}/releases/download/v#{HOMEBREW_DBCLI_VERSION}/db-darwin-amd64.tar.gz&quot;, :tag =&gt; &quot;v#{HOMEBREW_DBCLI_VERSION}&quot;
  sha256 '6bfc2486db1b17ab93d3b3783f5981b3676299319ff9208efd599a4843599a06'
  head REPOSITORY_URL, :branch =&gt; 'master'
  version HOMEBREW_DBCLI_VERSION

  def install
    bin.install 'db'
  end
end
</code></pre>

<p>Formula クラスの継承をしたうえで、各種ローカル変数を定義します。
下に書いてあるのですが、db-cli という名前なのでクラス名は DbCli で自動で決まるみたいですね。
最初は &ldquo;DBCli&rdquo; と書いていました・・・。</p>

<p>install メソッドを定義し、
場合によっては Ruby の外部コマンド実行ができる system コマンドで
実際にインストールに必要なコマンド類を入力してやる必要があるみたいなのですが、
<strong>今回の場合は配布想定のバイナリファイルを配置するだけで Golang 環境は不要なので、
bin.install で指定するだけで問題無い</strong> ようです。</p>

<p>これも Golang の強みの1つですね。
ビルド後のバイナリファイルは、Golang 環境がなくとも（go コマンドがインストールされてなくとも）
普通に動作するので、事前に動作環境をあれこれ入れる必要がないです。</p>

<p>ちなみに bin.install で指定するだけで勝手に圧縮ファイルを展開、配置までしてくれるようですね。</p>

<p>push できたら試しに <code>brew tap</code> してみます。</p>

<pre><code>$ brew tap girigiribauer/db-cli
</code></pre>

<p>どうやら Homebrew 1.0 あたりで auto update が自動で行われるようになったようです。
なのでアップデート待ちです。</p>

<pre><code>==&gt; Tapping girigiribauer/db-cli
Cloning into '/usr/local/Homebrew/Library/Taps/girigiribauer/homebrew-db-cli'...
remote: Counting objects: 4, done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 0), reused 3 (delta 0), pack-reused 0
Unpacking objects: 100% (4/4), done.
Checking connectivity... done.
Error: Invalid formula: /usr/local/Homebrew/Library/Taps/girigiribauer/homebrew-db-cli/db-cli.rb
No available formula with the name &quot;db-cli&quot;
In formula file: /usr/local/Homebrew/Library/Taps/girigiribauer/homebrew-db-cli/db-cli.rb
Expected to find class DbCli, but only found: DBCli.
Error: Cannot tap girigiribauer/db-cli: invalid syntax in tap!
</code></pre>

<p>あっその名前ダメですか・・・。
Golang だと逆に Db は DB にしろって言われるんですけどね・・・。
Ruby に素直に従っておきます。</p>

<p>ということで素直に DbCli に変更して再度トライ。</p>

<pre><code>$ brew tap girigiribauer/db-cli
==&gt; Tapping girigiribauer/db-cli
Cloning into '/usr/local/Homebrew/Library/Taps/girigiribauer/homebrew-db-cli'...
remote: Counting objects: 4, done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 0), reused 2 (delta 0), pack-reused 0
Unpacking objects: 100% (4/4), done.
Checking connectivity... done.
Tapped 1 formula (27 files, 20.3K)

$ brew install db-cli
==&gt; Installing db-cli from girigiribauer/db-cli
==&gt; Downloading https://github.com/girigiribauer/db-cli/releases/download/v0.1.24/db-darwin-amd64.tar.gz
==&gt; Downloading from https://github-cloud.s3.amazonaws.com/releases/69738247/d805382a-8822-11e6-89f4-aff058332cdf.g
######################################################################## 100.0%
🍺  /usr/local/Cellar/db-cli/0.1.24: 3 files, 8.6M, built in 9 seconds
</code></pre>

<p>ひゃっほーい🍺
オレオレ自作コマンドがとうとう Homebrew 経由で自分の元に。</p>

<h2 id="まとめ">まとめ</h2>

<p>バイナリ配置するだけなんで、
Homebrew の install メソッド内部でやってることもすごくシンプルですね。</p>

<p>namespace 的には既存の Homebrew には影響しないので、
今回のように超短いコマンド名で公開しても全く影響ありません。
（全くではないですね、インストール時に名前がかぶる可能性はあるので、その場合は別途リポジトリ指定する必要があるかもです）</p>

<p><img src="/img/2016/10/firsttime-homebrew01.jpg" alt="" /></p>

<p>全然関係ないけど、Homebrew の命名センスは結構好きですね。
ビールの自家醸造に例えて色々コマンド名が決まってて素敵だなあと思います。</p>

<p>僕ももうちょっとセンスのある命名を考えていければなと思います。
（末尾に24とかつけてる場合じゃない）</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md" target="_blank">https://github.com/Homebrew/brew/blob/master/docs/Formula-Cookbook.md</a></li>
<li><a href="http://dev.classmethod.jp/tool/new-formula-request-to-homebrew/" target="_blank">http://dev.classmethod.jp/tool/new-formula-request-to-homebrew/</a></li>
<li><a href="http://blog.monochromegane.com/blog/2014/05/19/homebrew-formula-for-golang/" target="_blank">http://blog.monochromegane.com/blog/2014/05/19/homebrew-formula-for-golang/</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年10月4日">2016年10月4日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/homebrew/">Homebrew</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年10月3日">2016年10月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>※どうでもいいけど、9月のブログ記事数が急に増えだしてます。
Hugo 化がここにきてすごく効いてきてますね。</p>

<p>この前 <strong>&ldquo;db-cli&rdquo;</strong> という自作コマンドをリリースしてみました。
コマンド名自体は <code>db</code> です。超短いので何かにかぶってたらゴメンナサイ。</p>

<p><a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a></p>

<h2 id="経緯">経緯</h2>

<p>何かプログラムなどを書いていて、
試しに MySQL(MariaDB) でもちょこっと立てて検証したいなあ、
みたいなことはたまにあると思います。</p>

<p>最近になって、ローカルにそういったデータベースをインストールせずに
Docker を利用するという選択肢も出てきたのですが、
まだちょっととっつきにくいというか、
<strong>長ったらしいコマンドをずらずらと並べて
コンテナを立てることになる</strong> ので、
結構面倒臭かったりします。</p>

<p>まだコマンドラインのヒストリーから Ctrl+R とかで探していればまだマシなのですが、
とても毎回ゼロから入力する気にはなれません。</p>

<p><strong>「僕は DB をちょこっと使いたいだけなんだよ！」</strong> というところから、
じゃあ試しに <strong>db って打ったら DB コンテナが立ち上がるようなコマンドでも作ってみるかー</strong> と思ったのがきっかけです。</p>

<h2 id="コンセプト">コンセプト</h2>

<ul>
<li><strong>by Golang</strong></li>
<li><strong>ストローク数は超短く。 D! B! Enter!</strong> で終わりにしたい。</li>
<li>僕はほとんど使わないが、必要に応じて <strong>オプションで上書き</strong> 可能。</li>
<li>Docker で名前つけるのすらだるい、 <strong>勝手につけてほしい。</strong></li>
<li>dump, restore も可能な限り楽にやりたい。</li>
</ul>

<p>こんな感じで、後はオプション指定で別のデータベースとか指定できたらいいなあとか、
配布もさくっとできたらいいなあとか、
（僕は使わないけど）Windows とかでも使えたらいいなあとか、
他にも様々ありますが、必要な項目としては上の4つです。</p>

<p>するともう自然とコマンド名は <code>db</code> に決まり、
コマンドラインを作るのに今適してそうな Golang で書くのに決めました。
（というか先に Golang で書くことだけは決まっていた気がする）</p>

<h2 id="インストール">インストール</h2>

<p><strong>先にDocker あるいは Docker for Mac/Windows を入れましょう。</strong></p>

<p>その後 MacOS であれば</p>

<pre><code>$ brew tap girigiribauer/db-cli

$ brew install db-cli
</code></pre>

<p>でインストールできます。
（Homebrew 対応の話はまた別にメモっておきます）</p>

<p>バイナリファイルが直接欲しい人は
<a href="https://github.com/girigiribauer/db-cli/releases" target="_blank">https://github.com/girigiribauer/db-cli/releases</a> にあります。</p>

<h2 id="使い方">使い方</h2>

<p>基本的にヘルプに全部書いてありますのでお読みください。</p>

<p>以下は <a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a> と同じ内容です。</p>

<h3 id="データベース作る">データベース作る</h3>

<pre><code>$ db
</code></pre>

<p>これだけで DB が立ち上がった状態になります。
MariaDB をイメージとした &ldquo;db0&rdquo; という名前のコンテナが起動状態になっていて、
通常利用するであろう 3306 ポートが空いていれば、その番号がそのままポートフォワーディングされます。</p>

<p>試しにもう1回 <code>db</code> と打てばわかりますが、名前が空いていなければ &ldquo;db1&rdquo;, &ldquo;db2&rdquo; と繰り上がり、
3306 ポートが空いていなければ自動で割り当てられます。</p>

<p>なので、 <strong>1つだけ使って消す、使って消す、みたいな使い方をしていれば、
名前は必ず &ldquo;db0&rdquo; になり、ポートは 3306 になります。</strong>
（実際僕の利用用途の9割くらいはこれで満たされてます）</p>

<p>データベース名は何もつけなければ &ldquo;db&rdquo; です。
ユーザー名もパスワードも初期値 &ldquo;db&rdquo; です。</p>

<h3 id="データベース消す">データベース消す</h3>

<pre><code>$ db -d
</code></pre>

<p><strong>消すのも合計6ストロークです。</strong> けっこう短くないですか？</p>

<p>これも上と同様で、&rdquo;db0&rdquo; があればそれが消えます。なければ &ldquo;db1&rdquo;, &ldquo;db2&rdquo; を探しにいきます。</p>

<h3 id="その他">その他</h3>

<p>オプション以外の設定項目も、一通り <strong>環境変数で上書きできるようになっています。</strong></p>

<p>例えば .bashrc などに</p>

<pre><code>DBCLI_CONTAINER_PREFIX=go
</code></pre>

<p>などと書いておけば、勝手に go0, go1 &hellip; という名前のコンテナが立ち上がります。</p>

<p>dump, restore もできるので、 <a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a> をお読みください。</p>

<h2 id="まだ微妙なところ">まだ微妙なところ</h2>

<p>TODO というわけではないのですが、うーん・・・と思ってるところが若干あります。
ただ自分用のコマンドを単に見えるようにしただけなので、
正直対応するかどうかは微妙です。</p>

<ul>
<li>Docker コンテナのヘルスチェック</li>
<li>test</li>
<li>PostgreSQL 対応</li>
</ul>

<h3 id="docker-コンテナのヘルスチェック">Docker コンテナのヘルスチェック</h3>

<p>正直なところ、Docker 1.12 あたりで導入された、
コンテナのヘルスチェック周りの知見がちょっと足らないかもです・・・。</p>

<p>この辺いじりだしたのは restore オプションの導入あたりからなのですが、
<code>db</code>, <code>db -d</code> コマンドだけ使っていれば、
ヘルスチェックなどはそもそも不要でした。（create -&gt; start するだけで問題ない）</p>

<p>restore オプションを実装するには、
コンテナを作るときにボリュームをマウントするなどの必要があったのですが、
あまり複雑なことをやりたくなかったので、
データベースが完全に用意できてから dump と同じ要領で <strong>外部からのコマンドを流し込む方法</strong> をとりました。</p>

<p>なお、今回は <strong>ボリュームのマウント機能は一切利用せずにコマンド作ってます。</strong>
ボリュームのマウントまで考慮に入れてしまうと、
じゃあローカルのどのディレクトリをマウント設定するんだとか、
そのオプションがなかった場合にどのような挙動になるんだとか、
色々（オペレーション的に）複雑になりすぎる気がしてたので
ボリュームを一切使わない方法はないか検討しました。</p>

<p>で、この <strong>データベースが完全に用意できてから</strong> というのが曲者で、
MariaDB が使えるようになるまで待機するのがどこまでなのかが未だによくわかっておりません・・・。</p>

<p><strong>mysqladmin の ping が通り始めるタイミング</strong> なのか、
あるいは <strong>&rdquo;/var/run/mysqld/mysqld.sock&rdquo; のファイルができるタイミング</strong> なのか、
いずれにしてもタイミングによって restore ができるときとできないときが出てきてしまうので、
5秒程度余分に待つといったダサい策をとってます。ぐぬぬ。</p>

<p>なのでもうちょっと Docker のヘルスチェックというか、
Docker を利用した MariaDB の起動の仕組みについてもう一段掘り下げてきちんと調べる必要がありそうですが、
正直そこまでコストかけるかどうか微妙なところです。</p>

<h3 id="test">test</h3>

<p>今回は API を叩くのがほとんどで、大きく DockerClient の状態に依存するので、
正直なところあまり頑張らずに DockerClient のエラーなどをそのまま垂れ流してもいいかなと思い、
あまり力を入れてません。</p>

<p>最初はイメージダウンロードしてコンテナ作った状態を再現してから、ってやってたんですが、
僕のストレスが増加しそうだったのでやめました。</p>

<h3 id="postgresql-対応">PostgreSQL 対応</h3>

<p>めんどかったので入れませんでした。
気が向いたら入れるかも。</p>

<p>一応ある程度楽には入れられるような作りにはなってます。</p>

<p>ただこれもヘルスチェックどうするんだ的な話が絡んでくるので、
気が向いたとしてもすぐ飽きるかもしれません。</p>

<h2 id="逆に思ったよりもよくできたところ-割り切ったところ">逆に思ったよりもよくできたところ、割り切ったところ</h2>

<ul>
<li>マルチプラットフォーム対応</li>
<li>そもそもの利用用途</li>
</ul>

<h3 id="マルチプラットフォーム対応">マルチプラットフォーム対応</h3>

<p>Golang のマルチプラットフォーム対応、なめてました。</p>

<pre><code>GOOS=windows GOARCH=amd64 go build -o build/windows-amd64/db.exe cmd/db/*.go
</code></pre>

<p><code>go build</code> コマンドの前に <code>GOOS</code> と <code>GOARCH</code> 環境変数をセットしてやるだけで
<strong>本当に Windows 用のバイナリが出来てしまいました。</strong></p>

<p>僕が使うわけではないので、あわよくば Windows 対応もできればいいなあくらいに思っていたのですが、
<strong>正直そんな手間もかからず（ゼロではないですが）対応できた</strong> のはありがたかったです。Golang マジすげえな。</p>

<p>ちょっと違うところといえば、
裏側で Docker Remote API を用いているのですが、
DockerClient のエンドポイントが Linux, MacOS は UNIX ドメインソケットなのに対して、
Windows では名前付きパイプ（npipe?）なんですよね。</p>

<p>ただこれも、大元のライブラリが普通に対応していて
パスの違いを吸収する程度の手間だったので
「まあこれくらいなら・・・」と思わせてくれるのは良いですね。</p>

<p>ちなみにこの DockerClient ライブラリに大きくお世話になりました。</p>

<p><a href="https://github.com/fsouza/go-dockerclient" target="_blank">https://github.com/fsouza/go-dockerclient</a></p>

<p><code>docker</code> コマンドで一通りできることは問題無くできると思います。</p>

<h3 id="そもそもの利用用途">そもそもの利用用途</h3>

<p>あまり大事にしたくなかったというか、試しに構築してみたいくらいの温度感だったので、
<strong>僕が使うプラスアルファの対応に留めたい</strong> と最初から思っていました。</p>

<p>なので、そもそも開発用としてローカルで使うもの前提だし、
レプリケーションやら dump 時のテーブルロックの話などはばっさり切り捨てています。</p>

<h2 id="まとめ">まとめ</h2>

<p>自分でコマンドを作ることは無くは無かったのですが、
表に出すところまではやったことがなかったので良い経験になりました。
Homebrew 対応についてはまた改めてメモっておきます。</p>

<p>Golang はクロスプラットフォームな CLI を作るのに適していると思います。</p>

<p>最後の方はみんなのGo言語も読みつつ進めていましたが、
ちょうど今回に合った話もちらほらあって読んでてとてもためになりました。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://godoc.org/github.com/fsouza/go-dockerclient" target="_blank">https://godoc.org/github.com/fsouza/go-dockerclient</a></li>
<li><a href="http://dev.classmethod.jp/cloud/aws/docker-healthcheck/" target="_blank">http://dev.classmethod.jp/cloud/aws/docker-healthcheck/</a></li>
<li><a href="https://suin.io/538" target="_blank">https://suin.io/538</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年10月3日">2016年10月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年9月3日">2016年9月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ftp/">FTP</a></li>
    <li class="flow"><a href="/tags/rsync/">rsync</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>ターミナルで何でも行う人にとって、FTP の GUI クライアントはもう辛すぎるのです。
コマンド1つで rsync のようにアップロードしたいのです。</p>

<p>同じように考える人は多いらしく、
&ldquo;rsync&rdquo;, &ldquo;FTP&rdquo; でググると &ldquo;rsync over FTP&rdquo; がどうのこうのと書かれた記事は散見するものの、
そんなものないけど、代わりに <strong>lftp</strong> 使うといいよ。みたいな記事が多くあります。</p>

<p>なので、（過去に1度使った記憶あるものの、改めて）試しに使ってみました。</p>

<p>なお、MacBook Pro の El Capitan です。Homebrew でインストールします。</p>

<pre><code>brew install lftp
man lftp
</code></pre>

<p>lftp コマンドは、基本的に ftp コマンドと同じく対話形式のコマンドなのですが、
オプションで -e や -c とともに対話形式の内容のコマンド（サブコマンド？）をつけてやると
そのまま実行できます。</p>

<p>また、対話形式をテキストファイルにまとめておき、 -f オプションで利用することも可能です。
以下は lftp コマンド自体のシンタックスとオプションです。（man lftp より抜粋）</p>

<pre><code>SYNTAX
       lftp [-d] [-e cmd] [-p port] [-u user[,pass]] [site]
       lftp -f script_file
       lftp -c commands
       lftp --version
       lftp --help

OPTIONS
       -d     Switch on debugging mode.

       -e commands
              Execute given commands and don't exit.

       -p port
              Use the given port to connect.

       -u user[,pass]
              Use the given username and  password  to  connect.  Remember  to
              quote  the  password properly in the shell. Also note that it is
              not secure to specify the password on command line, use ~/.netrc
              file   or   LFTP_PASSWORD  environment  variable  together  with
              --env-password option. Alternatively you can use ssh-based  pro-
              tocols  with authorized keys, so you don't have to enter a pass-
              word.


       --norc Don't execute rc files from the home directory.

       -f script_file
              Execute commands in the file and exit.  This option must be used
              alone without other arguments (except --norc).

       -c commands
              Execute  the  given commands and exit. Commands can be separated
              with a semicolon, `&amp;&amp;' or `||'. Remember to quote  the  commands
              argument  properly in the shell.  This option must be used alone
              without other arguments (except --norc).
</code></pre>

<p>上記から、接続情報は lftp のオプションとして渡しつつ、
それとは別に対話形式内のコマンドにて実際のファイルアップロードを行います。</p>

<p>今回はその中の mirror コマンドを利用し、 rsync に近いことを行ったのを
シェルスクリプトにまとめてみました。（接続情報はダミー）</p>

<pre><code>#!/bin/sh

HOSTNAME=192.0.2.24
USERNAME=girigiribauer
PASSWORD=passwordhere
SOURCE=&quot;path/to/source_dir&quot;
DIST=&quot;/path/to/target_dir&quot;

lftp -d -u $USERNAME,$PASSWORD $HOSTNAME -e &quot;\
  mirror \
  --reverse \
  --delete \
  --only-newer \
  --verbose \
  -X .DS_Store \
  $SOURCE \
  $DIST; \
  exit&quot;
</code></pre>

<p>後半が mirror コマンドのオプションですが、
reverse はアップロードを意味します。</p>

<p>色々オプションあるので詳しくはヘルプを見た方が良いのですが、
lftp の方のヘルプにはあまり詳しく載ってませんので
lftp コマンドをそのまま実行して対話形式にしてから
<code>help mirror</code> とすることで mirror コマンドの help を開くことができます。</p>

<pre><code>% lftp
lftp :~&gt; help mirror
Usage: mirror [OPTS] [remote [local]]

Mirror specified remote directory to local directory

 -c, --continue         continue a mirror job if possible
 -e, --delete           delete files not present at remote site
     --delete-first     delete old files before transferring new ones
 -s, --allow-suid       set suid/sgid bits according to remote site
     --allow-chown      try to set owner and group on files
     --ignore-time      ignore time when deciding whether to download
 -n, --only-newer       download only newer files (-c won't work)
 -r, --no-recursion     don't go to subdirectories
 -p, --no-perms         don't set file permissions
     --no-umask         don't apply umask to file modes
 -R, --reverse          reverse mirror (put files)
 -L, --dereference      download symbolic links as files
 -N, --newer-than=SPEC  download only files newer than specified time
 -P, --parallel[=N]     download N files in parallel
 -i RX, --include RX    include matching files
 -x RX, --exclude RX    exclude matching files
                        RX is extended regular expression
 -v, --verbose[=N]      verbose operation
     --log=FILE         write lftp commands being executed to FILE
     --script=FILE      write lftp commands to FILE, but don't execute them
     --just-print, --dry-run    same as --script=-

When using -R, the first directory is local and the second is remote.
If the second directory is omitted, basename of first directory is used.
If both directories are omitted, current local and remote directories are used.
</code></pre>

<p>今回は、手元のファイルのが新しい場合に動作し、
なおかつ手元で削除したファイルも同期を取りたいので、
 &ndash;delete と &ndash;only-newer オプションをつけました。</p>

<h2 id="まとめ">まとめ</h2>

<p>FTP だけでも rsync にある程度近いことは出来ました。</p>

<p>ただ、 dry-run 相当のオプションが探した限りなかったので、
実際に試しながら正しく動作しているか確認することになるので、
そこはちょっと怖いところではありますね・・・。</p>

<p><strong>2016/09/30追記</strong></p>

<p>さーせん、dry-run オプションありました・・・</p>

<p>&ndash;just-print, &ndash;dry-run    same as &ndash;script=- って上にあるじゃん、自分の目はフシ穴か・・・</p>

<p><strong>2016/09/30追記ここまで</strong></p>

<p>FTP のみという縛りがあったとしても、コマンド1つで転送できるようにしておけば、
バージョン管理などと連携してフックさせることも可能となり、
精神衛生的にも良いかと思います。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://lftp.yar.ru/" target="_blank">https://lftp.yar.ru/</a></li>
<li><a href="http://www.itmedia.co.jp/enterprise/articles/0804/25/news014.html" target="_blank">http://www.itmedia.co.jp/enterprise/articles/0804/25/news014.html</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年9月3日">2016年9月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ftp/">FTP</a></li>
    <li class="flow"><a href="/tags/rsync/">rsync</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2015年6月23日">2015年6月23日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>大学で初めて Linux を触りつつも、 その後働き始めてほぼ GUI オンリーの生活を送り、 iTerm, tmux, Vim 達とのと出会いを経て、 コマンドライン中心の生活を送っている girigiribauer ですこんにちは。</p>

<p>大学で初めて触り始めた頃は、コマンドの補完をタブキーで出来るだとか、上下キーで自分の打ったコマンド履歴を移動できたりと、単にコマンド名だけでなく、ショートカットキーも大事だなあと思いながら色々覚えていきました。 近年では VM 立ち上げたりタスクランナー走らせたりと、コマンドラインなしでは生きていけないくらいには使わせてもらってます。</p>

<p>ですが、過去のコマンドラインの履歴を入力するのに、後方からの<strong>履歴のインクリメンタルサーチ</strong>のショートカットが用意されていることを、僕は恥ずかしながらつい先日まで知りませんでした。（！）</p>

<p>同じ記事は溢れているかもしれませんが、まだ見ぬ『知らんかったー』って人のために、恥を忍んでメモっておこうと思います。</p>

<h2 id="コマンド履歴の後方からのインクリメンタルサーチ">コマンド履歴の後方からのインクリメンタルサーチ</h2>

<p>bash にも最初から入ってるんですねー。なんで知らなかったんでしょうねー。</p>

<p><strong>Ctrl-R</strong> を押すと、</p>

<pre><code>(reverse-i-search)`':
</code></pre>

<p>のような感じで表示され、そのまま過去に入力したコマンドを数文字打つと、インクリメンタルサーチの要領で候補が絞られていきます。</p>

<p>後方検索なので、複数の候補があれば新しいものが優先して表示されます。 ちなみに、前方検索もあって <strong>Ctrl-S</strong> らしいのですが、他のショートカットキーに割り当てられてあるケースも多いようなので、.bashrc なり .zshrc なりに書いてやる必要があります。</p>

<p>1時間前くらいに入力したけどもう一度同じコマンド打ちたいとか、そういったケースなどに重宝するかと思います。これは知ってて当たり前のショートカットですねサーセン・・・</p>

<h2 id="まとめ">まとめ</h2>

<p>マニュアルをちゃんと読もう。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2015年6月23日">2015年6月23日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2015年1月19日">2015年1月19日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/tmux/">tmux</a></li>
    <li class="flow"><a href="/tags/shellscript/">ShellScript</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>2015年最初の投稿です。本年もよろしくお願いいたします。</p>

<p>全然書いてなかったので書きます。 ブログは定期的に書いてないと書き方を忘れてしまいがちなので、 もう少し気軽に書いていければと思います。</p>

<h2 id="tmux-のウィンドウ-ペインの準備の時間を削りたい">tmux のウィンドウ、ペインの準備の時間を削りたい</h2>

<p><strong>tmux、めっちゃ便利ですよねー。</strong></p>

<p>便利なので、開きっぱなしにしちゃいがちなんですが、 本当は使うもの以外を閉じておきたいのです。</p>

<p>そもそも tmux のセッション管理だとか、あるいは <strong>tmuxinator</strong> など色々便利なものがありますが、 もうちょっと気軽にさくっと扱えればいいなーと思ってました。</p>

<p>何がやりたいかというと・・・</p>

<ol>
<li>少しのショートカットキーとプロジェクト名を入力するだけで準備が整う</li>
<li>エディター、シェル、タスクランナーの3分割</li>
<li>上記構成を比較的柔軟に変えられる</li>
</ol>

<p>このあたりができればいいなと思います。</p>

<h2 id="構成を考える">構成を考える</h2>

<p>特に tmux の細かな使い方が理解できていなかったので、 <code>man tmux</code> や <code>[prefix] ?</code> などでドキュメントを読んでみました。</p>

<pre><code># ウィンドウを新しく作って、最初のディレクトリを合わせて指定
new-window -c &quot;/path/to/dir&quot;

# ウィンドウを上下に分割（水平）
split-window -h

# 現在のペインに対してキー入力を行う
send-keys &quot;echo 'test123'&quot;

# tmux で入力を受け付けて、シェルスクリプトを実行
command-prompt &quot;run-shell 'cd /path/to/dir'&quot;
</code></pre>

<p>他にもたくさんありますが、今回関連しそうなのはこのあたりっぽいですねー。</p>

<h3 id="プロジェクト名を受け取り-画面を作るシェルスクリプト">プロジェクト名を受け取り、画面を作るシェルスクリプト</h3>

<p>まず、プロジェクト名の引数を1つとって、上記のコマンドの組み合わせでお好みのペインを作るところまでをシェルスクリプトで用意します。</p>

<p>たぶん人によってやりたいことは大分違ってきますし、 画面の分割以外にも<strong>シェルスクリプトでやれることなら色々と書ける</strong>はずなので、 僕の場合はタスクランナーを実際に走らせるところまでやっています。 （それ以上の細かいところは、これから考えていければと・・・）</p>

<pre><code>#!/bin/sh

if [ $# -eq 1 ]; then
  TMUX_PROJECT_NAME=&quot;/var/www/$1&quot;
else
  echo &quot;usage: tmux-project (projectname)&quot; 1&gt;&amp;2
  exit 1
fi

if [ ! -e $TMUX_PROJECT_NAME ]; then
  echo &quot;no exist: $TMUX_PROJECT_NAME&quot; 1&gt;&amp;2
  exit 1
fi

tmux new-window -c $TMUX_PROJECT_NAME
tmux split-window -c $TMUX_PROJECT_NAME -h
tmux split-window -c $TMUX_PROJECT_NAME -v

# has Gruntfile.js
if [ -e &quot;$TMUX_PROJECT_NAME/Gruntfile.js&quot; ]; then
  tmux send-keys &quot;grunt watch^M&quot;
fi

tmux select-pane -t 1
</code></pre>

<p>※実際はもっと具体的な記述になってますが、ざっくりこのような感じです。</p>

<p>このシェルスクリプトをとりあえず <strong>proj</strong> という名前にしておき、 ホームディレクトリの bin ディレクトリに入れて、パスを通して使ってます。 （＆実行権限も）</p>

<h3 id="tmux-の-command-prompt-run-shell-を使い-引数付きのシェルスクリプトを呼び出す">tmux の command-prompt, run-shell を使い、引数付きのシェルスクリプトを呼び出す</h3>

<p>今度は .tmux.conf に以下の設定を追記します。</p>

<pre><code># 予め用意した proj シェルスクリプトに tmux の入力受け付けで引数を渡す
# シェルスクリプト上でエディタ、シェル、タスクランナーなどに分割表示
bind-key P command-prompt -p &quot;projectname:&quot; &quot;run-shell 'proj %1'&quot;
</code></pre>

<p>プロジェクト管理ということなので、プレフィックスキーに続いて Shift-P キーで起動するようにしてみました。 command-prompt を割り当てた場合、そのキーを押すと以下のように入力部分が出てきます。</p>

<p><img src="/img/2015/01/tmuxproj01.png" alt="" /></p>

<p>入力した文字が <strong>%1</strong>, <strong>%2</strong> などで利用できるので、先ほどのシェルスクリプトと組み合わせると幸せになれますね。</p>

<h2 id="まとめ">まとめ</h2>

<p>tmux のオプションがたくさんあって、調べるのにけっこう時間かかってしまいましたが、 同じペインの組み合わせを作ることがけっこう多いので、 そういった部分は可能な限り<strong>自動化</strong>されていると良いですよね。</p>

<p>試してみて、以下の組み合わせは有用だと思いました。</p>

<ol>
<li><strong>tmux の command-prompt によるキーショートカット + キーワード入力</strong></li>
<li><strong>tmux の run-shell とシェルスクリプトによる任意コマンド実行</strong></li>
</ol>

<p>ベースの部分がシェルスクリプトなので、今後新たなツールとかが出てきたとしても、 コマンドラインで動作できるものであれば、シェルスクリプトに落とし込みが可能です。 依存してるものが少ないというのもメリットなのかもしれませんね。</p>

<p>ではそろそろ、元々の仕事に戻りたいと思います・・・。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/" target="_blank">http://mojavy.com/blog/2013/01/11/alc-nokogiri-tmux/</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2015年1月19日">2015年1月19日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/tmux/">tmux</a></li>
    <li class="flow"><a href="/tags/shellscript/">ShellScript</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2013年1月22日">2013年1月22日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
    <li class="flow"><a href="/tags/php/">PHP</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p><img src="/img/2013/01/neostudy011.png" alt="" /></p>

<p>先週末の 1/19（土）に、株式会社 音生（ねお）さんにお邪魔してきました。 その時の勉強会のレポートなどを軽くまとめてみようと思います。</p>

<h2 id="概要">概要</h2>

<p>勉強会の内容としては、前半が『Web作成者のためのLinuxサーバー入門』で、 後半が『PHPで作る簡易電卓』でした。 音生さんにてお勉強会が開催されるとのことだったので、これはぜひともお邪魔してみなければ！という思いで 参加させていただきました。</p>

<p>また、最近話題の<strong>黒い画面の勉強会</strong>に相当するということもあり、 どんな感じの勉強会になるのかなーという興味もかなりありました。</p>

<h2 id="web作成者のためのlinuxサーバー入門-前半">Web作成者のためのLinuxサーバー入門（前半）</h2>

<p>講師は音生の深谷さんで、だいたい以下のことをやりました。</p>

<ul>
<li>VirtualBoxのインストール</li>
<li>CentOSのインストール</li>
<li>ネットワークの設定（viを使って）</li>
</ul>

<p>CentOSは、WebサービスやWebサイトのサーバOSとしてよく使われるLinuxディストリビューションですね。それぞれ持って来たPCにVirtualBoxをインストールして、その仮想環境上にCentOSをインストールしました。</p>

<p>さらに、黒い画面上で簡単なコマンドの解説をしてもらいつつ、実際にネットワークの設定を vi を使って行いました。</p>

<h2 id="phpで作る簡易電卓-後半">PHPで作る簡易電卓（後半）</h2>

<p>講師は同じく音生の吉川さんで、後半は杉本さんのわかりやすーい説明のターンでした。 だいたい以下のような内容です。</p>

<ul>
<li>電卓アプリのサンプルコードを写経</li>
<li>簡単な文法の解説、と同時に概念の説明</li>
</ul>

<p>あまり時間もなかったので、まず一通りの解説どころの詰まったサンプルコードを写経して、自分で書いたサンプルコードに対して、これはこういう意味ですよ、といった形で理解を深めるような形式でした。</p>

<h2 id="良かったところ-気になったところ">良かったところ、気になったところ</h2>

<ul>
<li><strong>セキュリティ周りはやはり削らないところにこの勉強会の意義を感じた</strong></li>
<li>教え方が分かりやすかった

<ul>
<li>ゆるい比較と厳密な比較を定義だけ教えるのではなく、ゆるい比較であれば「trueっぽいよねー」「falseっぽいよねー」という概念含めて教えてくれてるのはすごくいいなと思った</li>
</ul></li>
<li>止まっちゃった人に対してマンツーマンでちゃんと付く体制が完璧で、ところどころ遅れた人が出ても問題なく進行して、<strong>みんなの理解度も一定を保ちつつ進行</strong>しててすごかった</li>
<li>これだけの内容を1日で（ゼロから説明して）やろうとすると、やっぱりところどころ駆け足になっちゃうのは仕方なさそう</li>
</ul>

<p>最後の、やりたい内容と最低限触れなきゃいけないところとのバランスですが、これは他のどの勉強会であっても、課題になりそうなところだと思います。</p>

<p>逆に削れるところあるのかなーとか考えてみたのですが、ひょっとしたら今は環境を丸々借りることができるので、その辺（インストール周り）を大胆に端折ってアプリケーション寄りの話を厚めにするのもありなのかなーとも思いました。</p>

<p>そういう意味で良い時代ですね。</p>

<h2 id="まとめ">まとめ</h2>

<ul>
<li>杉本さんの、押さえるところは押さえつつも崩して分かりやすく説明する、あのバランス感覚がすごかった</li>
<li>無料にも関わらず、参加者の意識が総じて高くて、そういった意味でも質の高い勉強会だった</li>
<li>懇親会が本番だ！</li>
</ul>

<p>今年の自分の目標でもある、自分が知っているものを、まだ知らない人に対して、分かりやすく伝える、というのを、まさに体現していた勉強会で、とても参考になりました。また参加したいですね！</p>

<h2 id="reference">参考URL</h2>

<ul>
<li><a href="http://atnd.org/event/E0011899?vos=cpatnsoccap0111026001" target="_blank">Web作成者のためのLinuxサーバー入門とPHPで作る簡易電卓 | 集客ならイベントアテンド</a></li>
<li><a href="http://blog.wnotes.net/blog/article/study-sessions-held" target="_blank">弊社主催の勉強会を開催しました | ブログ :: Web notes.log</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2013年1月22日">2013年1月22日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/linux/">Linux</a></li>
    <li class="flow"><a href="/tags/php/">PHP</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>







</div>

<footer>

<h2>Tags</h2>

<ul class="tags">
  <li class="flow">
    <a href="/tags/ansible">Ansible (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/apache">Apache (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cli">CLI (10)</a>
  </li>
  <li class="flow">
    <a href="/tags/css">CSS (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/css3">CSS3 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cssfilter">CSSfilter (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/canvas">Canvas (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/chef">Chef (9)</a>
  </li>
  <li class="flow">
    <a href="/tags/crawler">Crawler (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/dom">DOM (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/docker">Docker (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/ftp">FTP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/font">Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/functionallanguage">FunctionalLanguage (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/glsl">GLSL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/git">Git (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/golang">Golang (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/html">HTML (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5">HTML5 (7)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5-outline">HTML5-outline (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/homebrew">Homebrew (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/hugo">Hugo (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/icon-font">Icon-Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/javascript">JavaScript (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/linux">Linux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/mvc">MVC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/opengraph">OpenGraph (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/php">PHP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rdfa">RDFa (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ssh">SSH (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/svg">SVG (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/scala">Scala (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/shellscript">ShellScript (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/smartphone">Smartphone (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/static-site-generator">Static Site Generator (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vagrant">Vagrant (15)</a>
  </li>
  <li class="flow">
    <a href="/tags/vim">Vim (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualbox">VirtualBox (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">Virtualization (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webapp">WebApp (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webaudioapi">WebAudioAPI (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webfont">WebFont (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webgl">WebGL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webrtc">WebRTC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webserver">WebServer (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/yeoman">Yeoman (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/zsh">Zsh (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/ajax">ajax (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/automation">automation (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/bugs">bugs (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/event-conference">event-conference (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/getusermedia">getUserMedia (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/gitconfig">gitconfig (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ios">iOS (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/iterm">iTerm (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jquery">jQuery (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/jinja2">jinja2 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jq">jq (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jsperf">jsperf (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/mediaquery">mediaQuery (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/namespace">namespace (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/oldie">oldIE (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/output">output (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/polyfills">polyfills (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/preloader">preloader (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rsync">rsync (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/tmux">tmux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/viewport">viewport (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vimrc">vimrc (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">virtualization (6)</a>
  </li>
  <li class="flow">
    <a href="/tags/wget">wget (1)</a>
  </li>
</ul>

<h2>Categories</h2>

<ul>
  <li>
    <a href="/categories/tech/">Category / Tech</a>
  </li>
  <li>
    <a href="/categories/twentyfour/">Category / TwentyFour</a>
  </li>
</ul>

<h2>RSS</h2>

<ul>
  <li>
    <a href="/categories/tech/index.xml" target="_blank">RSS: Category / Tech</a>
  </li>
  <li>
    <a href="/index.xml" target="_blank">RSS: All articles</a>
  </li>
</ul>

<p>このブログは個人の見解であり、所属する組織の公式見解ではありません</p>
<p>&copy; ばうあーろぐ Generated by <a href="https://gohugo.io/" target="_blank">Hugo</a> and <a href="https://github.com/sindresorhus/github-markdown-css" target="_blank">github-markdown-css</a></p>

</footer>

</div>


<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36767095-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>



  </body>
</html>


