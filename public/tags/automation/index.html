<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/github-markdown.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="all">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://girigiribauer.com/index.xml">
    <title>automation - ばうあーろぐ</title>
    <meta property="og:title" content="automation - ばうあーろぐ">
    <meta property="og:type" content="article">
    <meta name="description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:url" content="http://girigiribauer.com/tags/automation/">
    <meta property="fb:app_id" content="396423247105258">
    <meta property="og:image" content="http://girigiribauer.com/img/ogimage.png">
<meta name="generator" content="Hugo 0.17" />
  </head>
  <body>

<div class="markdown-body">
<header>
<a href="/">ばうあーろぐ TOP へ戻る</a>
</header>


<div class="maincontents">

<h1>Tags / automation</h1>

<div class="poststatus">
  <p>  <time datetime="2016年9月6日">2016年9月6日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
  </ul>
</div>




<p>タイトルの通りですが、正直これ出来ないと思っていたので、出来てすごく嬉しいです。</p>

<p>Chef では少なくともそういった機能は無かったように思えますが（僕が知らないだけかもしれない）、
<strong>Ansible はプッシュベース</strong> だからでしょうか。
実行する主体がいつもローカル側にあるからこそ、
一旦接続を切ってまた繋げるといったことがやりやすいのかもしれません。</p>

<h2 id="そもそもなぜ再接続したいのか">そもそもなぜ再接続したいのか？</h2>

<p>ほとんどの playbook では問題ないのですが、
SELinux の設定の反映（一時的な設定だけなら問題なし）などの一部のセットアップにて、
<strong>再起動が必要になるものが存在しています。</strong></p>

<p>他にもあるかもしれませんが、
例えば SELinux の設定をいじる場合は以下のような手順を踏みます。</p>

<pre><code>$ getenforce #=&gt; 今の設定確認
Enforcing
$ sudo vi /etc/sysconfig/selinux #=&gt; SELINUX=disabled を設定
$ sudo reboot #=&gt; 再起動
</code></pre>

<p>Ansible では playbook 上で reboot すると、
<strong>playbook のステータスが unreachable になってそのまま終了</strong> してしまいます。</p>

<pre><code>fatal: [machine_name]: UNREACHABLE! =&gt; {&quot;changed&quot;: false, &quot;msg&quot;: &quot;Failed to connect to the host via ssh.&quot;, &quot;unreachable&quot;: true}
</code></pre>

<p>繋がらなくなるのでまあ当然ですよね。</p>

<p>これを一連の playbook で再起動をはさんで実行できると、
playbook を書くときにトリッキーなことをせずに済むこともあるかもしれません。
（SELinux だけみると、最後にまとめて再起動すれば事足りるっちゃあそうですが・・・。）</p>

<p>ちょっと話が逸れますが、 reboot するのが通常の task ではなく handler だった場合、
（handler は変化があった場合のみ、最後にまとめて実行するタスクのこと）
単に再起動だけ実行させて、あとはほったらかしで問題ないケースも出てきます。
その場合は playbook の実行完了を待たない poll の値を設定することで、handler で再起動をさせて終了させることは可能です。</p>

<p><a href="http://docs.ansible.com/ansible/playbooks_async.html" target="_blank">http://docs.ansible.com/ansible/playbooks_async.html</a></p>

<h2 id="再接続を可能にする-ansible-のモジュール">再接続を可能にする Ansible のモジュール</h2>

<p>Ansible で再接続を行うために必要な関連モジュールをメモっておきます。
最初のやつは正確にはモジュールではないかもしれません。キーワード？</p>

<h3 id="local-action">local_action</h3>

<p><a href="http://docs.ansible.com/ansible/playbooks_delegation.html" target="_blank">http://docs.ansible.com/ansible/playbooks_delegation.html</a></p>

<p>この local_action は他のモジュールと同じように使うことが出来るのですが、
モジュールのさらに頭につけることで
<strong>ローカルに処理を委譲することができます。</strong></p>

<p>ちなみに <code>delegate_to</code> というキーワードも存在していて、以下は同じ意味を指すようです。
（先ほどのリンク内から抜粋）</p>

<pre><code>- name: add back to load balancer pool
command: /usr/bin/add_back_to_pool {{ inventory_hostname }}
delegate_to: 127.0.0.1

- name: take out of load balancer pool
local_action: command /usr/bin/take_out_of_pool {{ inventory_hostname }}
</code></pre>

<h3 id="wait-for-モジュール">wait_for モジュール</h3>

<p><a href="http://docs.ansible.com/ansible/wait_for_module.html" target="_blank">http://docs.ansible.com/ansible/wait_for_module.html</a></p>

<p>wait_for モジュールは、 <strong>指定したホスト名・ポートを監視し、有効になるまで待機します。</strong></p>

<p>先に非同期で再起動するような playbook を用意しておき、
その後 local_action をはさんだ wait_for モジュールを利用して、
再起動で処理が戻るまで待機するような playbook を書くことが可能です。</p>

<h3 id="set-fact-モジュール">set_fact モジュール</h3>

<p><a href="http://docs.ansible.com/ansible/set_fact_module.html" target="_blank">http://docs.ansible.com/ansible/set_fact_module.html</a></p>

<p>set_fact モジュールは、ansible-playbook の <strong>実行時の変数を途中で上書きできるモジュール</strong> です。</p>

<p>今回は結局使わなかったのですが、
例えばポート番号を変えたり、パスワード認証から公開鍵認証に変えたりした場合に、
接続するための情報を途中で変更する際に用いました。</p>

<p>あくまで僕のケースですが、個人的には接続方法が大きく変わった時には無理をせず、
強制的に fail などのメッセージを出して（鍵認証に変えたから接続し直してね的なやつ）、
変更後の接続方法で改めて playbook を実行するようにしています。
（この辺の話はまた長くなるので、余裕があれば改めて取りまとめたいですね・・・）</p>

<h2 id="selinux-の-playbook">SELinux の playbook</h2>

<p>他 playbook も参考にしながら、冪等性も踏まえて書いてみたのがこれです。
（抜粋＆本筋じゃないところは省略）</p>

<pre><code>- name: SELinux のステータス取得
  shell: getenforce
  register: selinux_status
  changed_when: False
  tags: selinux
  become: True

- name: SELinux をコントロールするためのパッケージ導入
  yum: name=libselinux-python state=installed
  when: selinux_status.stdout == 'Enforcing'
  tags: selinux
  become: True

- name: SELinux の無効化
  selinux: state=disabled
  when: selinux_status.stdout == 'Enforcing'
  tags: selinux
  become: True

- name: SELinux 設定後の再起動
  shell: &quot;sleep 2 &amp;&amp; reboot&quot;
  async: 1
  poll: 0
  when: selinux_status.stdout == 'Enforcing'
  tags: selinux
  become: True

- name: SELinux 設定後の再起動完了まで待機
  local_action: wait_for host={{ inventory_hostname }} port={{ ssh_port }} delay=30
  when: selinux_status.stdout == 'Enforcing'
  tags: selinux
  become: False
</code></pre>

<p>inventory_hostname は <a href="http://docs.ansible.com/ansible/playbooks_variables.html" target="_blank">http://docs.ansible.com/ansible/playbooks_variables.html</a> にあるように
Ansible のインベントリファイルがあるローカルを指しています。予め用意されている変数です。</p>

<p>register については
<a href="http://docs.ansible.com/ansible/playbooks_conditionals.html#register-variables" target="_blank">http://docs.ansible.com/ansible/playbooks_conditionals.html#register-variables</a> にありますが、
実行結果などを後で参照するために一時保存してくれる機能です。</p>

<p>SELinux の設定を取得して、有効になっていた場合のみ無効となるような playbook を実行しています（冪等性）。
逆に <strong>2回目以降の playbook の実行ですでに無効になっていた場合は、
when と書いてあるところが False になるので playbook の実行がスキップされます。</strong>
毎回再起動をはさんでいては時間がかかってしまいますので、
時間短縮のため register や when などを用いて変更する必要があるときだけ処理をするようにしています。</p>

<p>ちなみに、再起動自体の playbook ですが、
sleep 2 や async: 1 がないと一番最初の例と同じく unreachable でストップしてしまいます。
shell モジュール内で sleep 2 などを頭につけて実行直後に再起動が実行されないようにしつつ、
async でこの playbook の終了タイミング自体も直後ではなく後ろにずらす必要がありました。</p>

<p>様々な環境で試したところ、両方ずらす必要があるようです。
最初は単にタイミングをずらすだけで良いかと思って sleep 1 になってたんですが、
Vagrant 上は問題がなくとも VPS 上では sleep 2 にしないと unreachable になってしまったりと、
再起動周りは多少経験則が必要なようです・・・。</p>

<p>ここに関しては内部の処理を見たわけではないのですが、
タイミングをずらすことで、再起動の処理の前に
次の local_action &amp; wait_for モジュールに処理を渡してから再起動を行う必要があるようです。</p>

<h2 id="まとめ">まとめ</h2>

<p>Ansible のプッシュベースであるメリットが出てて便利だなーと思います。</p>

<p>再起動の playbook については、今まで問題があったわけではないのですが、
selinux の部分だけで設定完了することになるので、
playbook の依存関係が少しすっきりした気がします。
ただ、再起動タスクが多ければ多いほど、
最後にまとめて handler として実行した方が playbook 全体の処理時間は短くなると思います。</p>

<p>あと playbook の書き順によっては接続ポートの変更とかぶった場合、
<strong>再起動後に SSH のポートが変わっちゃって接続できなくなっちゃった、</strong> みたいなケースもありうるので
そこは注意が必要かと思います。（今回使っていないset_fact モジュールである程度いけるかと思います）</p>

<p>ちなみに再起動に関してはこの記事の通りなのですが、
再ログインに関してはまだまとめきれてないので、
改めて記事にメモっておこうと思います。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="http://qiita.com/volanja/items/d38fe0678848bae6902f" target="_blank">http://qiita.com/volanja/items/d38fe0678848bae6902f</a></li>
<li><a href="https://gyagya1111.blogspot.jp/2015/02/ansibleselinux.html" target="_blank">https://gyagya1111.blogspot.jp/2015/02/ansibleselinux.html</a></li>
<li><a href="http://jinja.pocoo.org/docs/dev/templates/" target="_blank">http://jinja.pocoo.org/docs/dev/templates/</a></li>
<li><a href="http://stackoverflow.com/questions/23877781/how-to-wait-for-server-restart-using-ansible" target="_blank">http://stackoverflow.com/questions/23877781/how-to-wait-for-server-restart-using-ansible</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年9月6日">2016年9月6日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年9月3日">2016年9月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ftp/">FTP</a></li>
    <li class="flow"><a href="/tags/rsync/">rsync</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>ターミナルで何でも行う人にとって、FTP の GUI クライアントはもう辛すぎるのです。
コマンド1つで rsync のようにアップロードしたいのです。</p>

<p>同じように考える人は多いらしく、
&ldquo;rsync&rdquo;, &ldquo;FTP&rdquo; でググると &ldquo;rsync over FTP&rdquo; がどうのこうのと書かれた記事は散見するものの、
そんなものないけど、代わりに <strong>lftp</strong> 使うといいよ。みたいな記事が多くあります。</p>

<p>なので、（過去に1度使った記憶あるものの、改めて）試しに使ってみました。</p>

<p>なお、MacBook Pro の El Capitan です。Homebrew でインストールします。</p>

<pre><code>brew install lftp
man lftp
</code></pre>

<p>lftp コマンドは、基本的に ftp コマンドと同じく対話形式のコマンドなのですが、
オプションで -e や -c とともに対話形式の内容のコマンド（サブコマンド？）をつけてやると
そのまま実行できます。</p>

<p>また、対話形式をテキストファイルにまとめておき、 -f オプションで利用することも可能です。
以下は lftp コマンド自体のシンタックスとオプションです。（man lftp より抜粋）</p>

<pre><code>SYNTAX
       lftp [-d] [-e cmd] [-p port] [-u user[,pass]] [site]
       lftp -f script_file
       lftp -c commands
       lftp --version
       lftp --help

OPTIONS
       -d     Switch on debugging mode.

       -e commands
              Execute given commands and don't exit.

       -p port
              Use the given port to connect.

       -u user[,pass]
              Use the given username and  password  to  connect.  Remember  to
              quote  the  password properly in the shell. Also note that it is
              not secure to specify the password on command line, use ~/.netrc
              file   or   LFTP_PASSWORD  environment  variable  together  with
              --env-password option. Alternatively you can use ssh-based  pro-
              tocols  with authorized keys, so you don't have to enter a pass-
              word.


       --norc Don't execute rc files from the home directory.

       -f script_file
              Execute commands in the file and exit.  This option must be used
              alone without other arguments (except --norc).

       -c commands
              Execute  the  given commands and exit. Commands can be separated
              with a semicolon, `&amp;&amp;' or `||'. Remember to quote  the  commands
              argument  properly in the shell.  This option must be used alone
              without other arguments (except --norc).
</code></pre>

<p>上記から、接続情報は lftp のオプションとして渡しつつ、
それとは別に対話形式内のコマンドにて実際のファイルアップロードを行います。</p>

<p>今回はその中の mirror コマンドを利用し、 rsync に近いことを行ったのを
シェルスクリプトにまとめてみました。（接続情報はダミー）</p>

<pre><code>#!/bin/sh

HOSTNAME=192.0.2.24
USERNAME=girigiribauer
PASSWORD=passwordhere
SOURCE=&quot;path/to/source_dir&quot;
DIST=&quot;/path/to/target_dir&quot;

lftp -d -u $USERNAME,$PASSWORD $HOSTNAME -e &quot;\
  mirror \
  --reverse \
  --delete \
  --only-newer \
  --verbose \
  -X .DS_Store \
  $SOURCE \
  $DIST; \
  exit&quot;
</code></pre>

<p>後半が mirror コマンドのオプションですが、
reverse はアップロードを意味します。</p>

<p>色々オプションあるので詳しくはヘルプを見た方が良いのですが、
lftp の方のヘルプにはあまり詳しく載ってませんので
lftp コマンドをそのまま実行して対話形式にしてから
<code>help mirror</code> とすることで mirror コマンドの help を開くことができます。</p>

<pre><code>% lftp
lftp :~&gt; help mirror
Usage: mirror [OPTS] [remote [local]]

Mirror specified remote directory to local directory

 -c, --continue         continue a mirror job if possible
 -e, --delete           delete files not present at remote site
     --delete-first     delete old files before transferring new ones
 -s, --allow-suid       set suid/sgid bits according to remote site
     --allow-chown      try to set owner and group on files
     --ignore-time      ignore time when deciding whether to download
 -n, --only-newer       download only newer files (-c won't work)
 -r, --no-recursion     don't go to subdirectories
 -p, --no-perms         don't set file permissions
     --no-umask         don't apply umask to file modes
 -R, --reverse          reverse mirror (put files)
 -L, --dereference      download symbolic links as files
 -N, --newer-than=SPEC  download only files newer than specified time
 -P, --parallel[=N]     download N files in parallel
 -i RX, --include RX    include matching files
 -x RX, --exclude RX    exclude matching files
                        RX is extended regular expression
 -v, --verbose[=N]      verbose operation
     --log=FILE         write lftp commands being executed to FILE
     --script=FILE      write lftp commands to FILE, but don't execute them
     --just-print, --dry-run    same as --script=-

When using -R, the first directory is local and the second is remote.
If the second directory is omitted, basename of first directory is used.
If both directories are omitted, current local and remote directories are used.
</code></pre>

<p>今回は、手元のファイルのが新しい場合に動作し、
なおかつ手元で削除したファイルも同期を取りたいので、
 &ndash;delete と &ndash;only-newer オプションをつけました。</p>

<h2 id="まとめ">まとめ</h2>

<p>FTP だけでも rsync にある程度近いことは出来ました。</p>

<p>ただ、 dry-run 相当のオプションが探した限りなかったので、
実際に試しながら正しく動作しているか確認することになるので、
そこはちょっと怖いところではありますね・・・。</p>

<p><strong>2016/09/30追記</strong></p>

<p>さーせん、dry-run オプションありました・・・</p>

<p>&ndash;just-print, &ndash;dry-run    same as &ndash;script=- って上にあるじゃん、自分の目はフシ穴か・・・</p>

<p><strong>2016/09/30追記ここまで</strong></p>

<p>FTP のみという縛りがあったとしても、コマンド1つで転送できるようにしておけば、
バージョン管理などと連携してフックさせることも可能となり、
精神衛生的にも良いかと思います。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://lftp.yar.ru/" target="_blank">https://lftp.yar.ru/</a></li>
<li><a href="http://www.itmedia.co.jp/enterprise/articles/0804/25/news014.html" target="_blank">http://www.itmedia.co.jp/enterprise/articles/0804/25/news014.html</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年9月3日">2016年9月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ftp/">FTP</a></li>
    <li class="flow"><a href="/tags/rsync/">rsync</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2014年8月12日">2014年8月12日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ssh/">SSH</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
  </ul>
</div>




<p>どうしても環境を変えられず SSH のパスフレーズを手動入力せざるをえないときってありますよね？</p>

<p>それが1回、2回であればまだ良いのですが、ある程度定期的に SSH でログインしてあれこれやらなきゃいけないってなると、もう発狂ものです。</p>

<p>こういったケースはときどき発生するのですが、<strong>実は自動入力出来る方法がある</strong>ってことをふいに知ったのでメモっておきます。</p>

<p>※数ヶ月前の話ですが、それでもブログに記録を残しておいた方が良いと思ったので、タイミングずれましたが書いておきます。</p>

<h2 id="ssh-でのログインの仕方">SSH でのログインの仕方</h2>

<p>先に、普通に SSH でログインする方法とベストな選択肢に触れておきます。</p>

<p>一番シンプルに使うのなら、以下の方法ですね。</p>

<pre><code>ssh -p 12345 user@example.com
</code></pre>

<p>ユーザー名: user、ポート番号: 12345 のとき、パスフレーズなしで公開鍵認証の設定がしてあれば、このままログイン出来るはずです。</p>

<h3 id="毎回やることが決まっているとき">毎回やることが決まっているとき</h3>

<p>これも今回のケースが解決してから知ったので余談になりますが、 ログイン先のサーバにて公開鍵を載せておくファイル、<code>.ssh/authorized_keys</code> に <code>command=&quot;command&quot;</code> といった形式でコマンドを書いておくと、<strong>ここに書かれたコマンドしか実行出来なくなる</strong>ようです。</p>

<p>今度改めて調べてみようかな。</p>

<h2 id="手動入力を強いられているんだ">手動入力を強いられているんだ！</h2>

<p>さて、上記の SSH によるログインで、パスフレーズが設定されていた場合、</p>

<pre><code>user@example.com's password: 
</code></pre>

<p>こんな感じに、「パスフレーズを入力してね？」と表示されるわけですが、 毎回毎回与えられたパスフレーズをテキストファイルからコピってターミナルに貼付けて・・・とやっていると、<strong>段々と強いられている感がじわじわきて心情的にもよろしくありません。</strong></p>

<p>実はこちら、<strong>expect, spawn, send</strong> あたりのコマンドを使うことにより、手動想定のインタラクティブな入力画面においても、自動で入力、その後のコマンドが実行できます。（全部使ったことなかった・・・）</p>

<h3 id="expect-コマンド">expect コマンド</h3>

<p>期待した入力と一致した場合に、任意のコマンドを実行できます。</p>

<p>-c オプションとともにコマンドを渡すことが出来ます。さらにこのコマンド内で interact コマンドを呼ぶと、処理をシェルに戻してくれると。</p>

<h3 id="spawn-コマンド">spawn コマンド</h3>

<p>後に続くコマンドを送り先で実行します。expect コマンドとセットで使うこと前提なんですかね？</p>

<h3 id="send-コマンド">send コマンド</h3>

<p>今回のようなケースでは、expect コマンドの後に実際の入力待ちで入力を行う場合などに使います。</p>

<h3 id="組み合わせ例">組み合わせ例</h3>

<pre><code>expect -c &quot;
spawn command arg1 arg2
expect \&quot;user@example.com's password: \&quot;
sleep 1
send \&quot;passphrase123\n\&quot;
interact
&quot;
</code></pre>

<p>あとは、これを例えばシェルコマンドとしてファイルにまとめておいて、任意のタイミングで実行してあげれば良いだけですね。</p>

<p>内部の expect コマンドで「パスフレーズを入力してね？」と聞かれた際に、 予めこういうテキストが入力されたら、と用意されているところにマッチするので、パスフレーズを send コマンドで送ってくれます。<strong>自動化最高。</strong></p>

<h2 id="まとめ">まとめ</h2>

<p>『なぜ知らなかった』の一言に尽きます。</p>

<p>今度機会があれば、もうちょっと掘り下げて使えるようになりたいですね！</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="http://www.uetyi.mydns.jp/wordpress/command/entry-158.html" target="_blank">expectコマンドの使い方 – No:158 – Linuxで自宅サーバ構築（新森からの雑記）</a></li>
<li><a href="http://blog.wnotes.net/blog/article/expect-other-programs" target="_blank">http://blog.wnotes.net/blog/article/expect-other-programs</a></li>
<li><a href="http://d.hatena.ne.jp/lurker/20060728/1154093951" target="_blank">http://d.hatena.ne.jp/lurker/20060728/1154093951</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2014年8月12日">2014年8月12日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ssh/">SSH</a></li>
    <li class="flow"><a href="/tags/automation/">automation</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>







</div>

<footer>

<h2>Tags</h2>

<ul class="tags">
  <li class="flow">
    <a href="/tags/ansible">Ansible (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/apache">Apache (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cli">CLI (10)</a>
  </li>
  <li class="flow">
    <a href="/tags/css">CSS (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/css3">CSS3 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cssfilter">CSSfilter (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/canvas">Canvas (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/chef">Chef (9)</a>
  </li>
  <li class="flow">
    <a href="/tags/crawler">Crawler (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/dom">DOM (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/docker">Docker (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/ftp">FTP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/font">Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/functionallanguage">FunctionalLanguage (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/glsl">GLSL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/git">Git (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/golang">Golang (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/html">HTML (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5">HTML5 (7)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5-outline">HTML5-outline (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/homebrew">Homebrew (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/hugo">Hugo (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/icon-font">Icon-Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/javascript">JavaScript (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/linux">Linux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/mvc">MVC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/opengraph">OpenGraph (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/php">PHP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rdfa">RDFa (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ssh">SSH (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/svg">SVG (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/scala">Scala (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/shellscript">ShellScript (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/smartphone">Smartphone (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/static-site-generator">Static Site Generator (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vagrant">Vagrant (15)</a>
  </li>
  <li class="flow">
    <a href="/tags/vim">Vim (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualbox">VirtualBox (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">Virtualization (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webapp">WebApp (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webaudioapi">WebAudioAPI (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webfont">WebFont (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webgl">WebGL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webrtc">WebRTC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webserver">WebServer (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/yeoman">Yeoman (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/zsh">Zsh (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/ajax">ajax (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/automation">automation (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/bugs">bugs (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/event-conference">event-conference (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/getusermedia">getUserMedia (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/gitconfig">gitconfig (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ios">iOS (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/iterm">iTerm (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jquery">jQuery (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/jinja2">jinja2 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jq">jq (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jsperf">jsperf (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/lint">lint (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/mediaquery">mediaQuery (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/namespace">namespace (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/oldie">oldIE (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/output">output (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/polyfills">polyfills (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/preloader">preloader (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rsync">rsync (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/tmux">tmux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/viewport">viewport (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vimrc">vimrc (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">virtualization (6)</a>
  </li>
  <li class="flow">
    <a href="/tags/wget">wget (1)</a>
  </li>
</ul>

<h2>Categories</h2>

<ul>
  <li>
    <a href="/categories/tech/">Category / Tech</a>
  </li>
  <li>
    <a href="/categories/twentyfour/">Category / TwentyFour</a>
  </li>
</ul>

<h2>RSS</h2>

<ul>
  <li>
    <a href="/categories/tech/index.xml" target="_blank">RSS: Category / Tech</a>
  </li>
  <li>
    <a href="/index.xml" target="_blank">RSS: All articles</a>
  </li>
</ul>

<p>このブログは個人の見解であり、所属する組織の公式見解ではありません</p>
<p>&copy; ばうあーろぐ Generated by <a href="https://gohugo.io/" target="_blank">Hugo</a> and <a href="https://github.com/sindresorhus/github-markdown-css" target="_blank">github-markdown-css</a></p>

</footer>

</div>


<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36767095-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>



  </body>
</html>


