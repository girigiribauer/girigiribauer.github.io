<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="/css/github-markdown.css" type="text/css" media="all">
    <link rel="stylesheet" href="/css/style.css" type="text/css" media="all">
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://girigiribauer.com/index.xml">
    <title>Docker - ばうあーろぐ</title>
    <meta property="og:title" content="Docker - ばうあーろぐ">
    <meta property="og:type" content="article">
    <meta name="description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:description" content="Webテクノロジーに関するメモ、あるいはTwentyFour">
    <meta property="og:url" content="http://girigiribauer.com/tags/docker/">
    <meta property="fb:app_id" content="396423247105258">
    <meta property="og:image" content="http://girigiribauer.com/img/ogimage.png">
<meta name="generator" content="Hugo 0.17" />
  </head>
  <body>

<div class="markdown-body">
<header>
<a href="/">ばうあーろぐ TOP へ戻る</a>
</header>


<div class="maincontents">

<h1>Tags / Docker</h1>

<div class="poststatus">
  <p>  <time datetime="2016年11月29日">2016年11月29日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/vagrant/">Vagrant</a></li>
  </ul>
</div>




<p>メモとして残しておきます。</p>

<h2 id="ansible-playbook-で急に表示できなくなった">ansible-playbook で急に表示できなくなった</h2>

<p>本番環境の CentOS7 と、その検証環境（Vagrant on Mac）で
Ansible 経由で Docker をインストールして使っていたのですが、
ある日 <code>ansible-playbook</code> を実行すると急に表示できなくなりました。</p>

<p>（Chef を使ってたころはこういうの頻発してたなあ・・・）</p>

<p>その間は Vagrant のアップデートくらいしかしてなかったので、
順に確認していくことに。</p>

<h3 id="各種ログ">各種ログ</h3>

<p>nginx-proxy のログは</p>

<pre><code>lrwxrwxrwx 1 root root   11 Aug 24 03:51 access.log -&gt; /dev/stdout
lrwxrwxrwx 1 root root   11 Aug 24 03:51 error.log -&gt; /dev/stderr
</code></pre>

<p>のような感じで、特に何も指定してなければ外にログとして出るようになってます。</p>

<p><code>docker logs -f nginx-proxy</code> などとしてログを表示させたりしても特に問題は見受けられず。</p>

<p>また、 /etc/nginx/conf.d/default.conf のファイルも特に問題なく、
コンテナが作られると適切に設定が書き換わっているようでした。</p>

<h3 id="自動と手動">自動と手動</h3>

<p>次に ansible のレイヤーで問題が起きている可能性を考えて、
自動で作った Docker コンテナをそのまま手動で作ってみました。</p>

<p>するとコンソールに見慣れないメッセージが。</p>

<pre><code>WARNING: IPv4 forwarding is disabled. Networking will not work.
</code></pre>

<p>なんだこれ。</p>

<h3 id="本番環境と検証環境">本番環境と検証環境</h3>

<p>さらに、本番環境と検証環境とで同様にコンテナを作って比較してみると、
上記メッセージは表示されずに、問題なくコンテナが作成されました。</p>

<h3 id="最後にググる">最後にググる</h3>

<p>ここまでくるとローカルの環境に何かしら問題が起きた可能性があるので、
先ほどのメッセージも加味して調べると、以下のような情報が引っかかりました。</p>

<p><a href="http://chrisgilmerproj.github.io/ubuntu/network/docker/2013/09/05/ipv4-forwarding-and-docker.html" target="_blank">http://chrisgilmerproj.github.io/ubuntu/network/docker/2013/09/05/ipv4-forwarding-and-docker.html</a></p>

<p>どうやら <code>sysctl</code> コマンドでカーネルパラメータを変更して、
IPv4 を有効にしてやる必要があるようなのですが、
正直どうしてこうなった感が満載です。</p>

<p>うーん・・・今まで問題なく動作していたんですが。
（とはいえ、ここから先の原因追求は不毛なのでやめておきます。）</p>

<p>ローカルの VM にのみ起きる問題であるため、こちらについては Ansible で行おうとせず、
その手前の Vagrantfile で VM を作る段階で差分を吸収することにします。</p>

<pre><code>config.vm.define &quot;vmname&quot; do |node|
  # for docker networking
  node.vm.provision &quot;shell&quot;, :inline =&gt; &quot;sudo sysctl -w net.ipv4.ip_forward=1&quot;, run: &quot;always&quot;
end
</code></pre>

<h3 id="おまけ">おまけ</h3>

<p>調べる途中で nginx-proxy のログのタイムゾーンが UTC だったので、
これなんとかならんかなーと思って少し寄り道して調べてたのですが、
スマートな方法があったのでついでに。</p>

<p><a href="http://qiita.com/ganta/items/a0f34866c994ebaeef69" target="_blank">http://qiita.com/ganta/items/a0f34866c994ebaeef69</a></p>

<p>docker run するときにホストの /etc/localtime をコンテナの /etc/localtime にバインドしてやれば良かったのでした。</p>

<blockquote>
<p>-v /etc/localtime:/etc/localtime:ro</p>
</blockquote>

<p>なんで思いつかなかったんだろう。すごくシンプルで良いです。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年11月29日">2016年11月29日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/vagrant/">Vagrant</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年10月3日">2016年10月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>




<p>※どうでもいいけど、9月のブログ記事数が急に増えだしてます。
Hugo 化がここにきてすごく効いてきてますね。</p>

<p>この前 <strong>&ldquo;db-cli&rdquo;</strong> という自作コマンドをリリースしてみました。
コマンド名自体は <code>db</code> です。超短いので何かにかぶってたらゴメンナサイ。</p>

<p><a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a></p>

<h2 id="経緯">経緯</h2>

<p>何かプログラムなどを書いていて、
試しに MySQL(MariaDB) でもちょこっと立てて検証したいなあ、
みたいなことはたまにあると思います。</p>

<p>最近になって、ローカルにそういったデータベースをインストールせずに
Docker を利用するという選択肢も出てきたのですが、
まだちょっととっつきにくいというか、
<strong>長ったらしいコマンドをずらずらと並べて
コンテナを立てることになる</strong> ので、
結構面倒臭かったりします。</p>

<p>まだコマンドラインのヒストリーから Ctrl+R とかで探していればまだマシなのですが、
とても毎回ゼロから入力する気にはなれません。</p>

<p><strong>「僕は DB をちょこっと使いたいだけなんだよ！」</strong> というところから、
じゃあ試しに <strong>db って打ったら DB コンテナが立ち上がるようなコマンドでも作ってみるかー</strong> と思ったのがきっかけです。</p>

<h2 id="コンセプト">コンセプト</h2>

<ul>
<li><strong>by Golang</strong></li>
<li><strong>ストローク数は超短く。 D! B! Enter!</strong> で終わりにしたい。</li>
<li>僕はほとんど使わないが、必要に応じて <strong>オプションで上書き</strong> 可能。</li>
<li>Docker で名前つけるのすらだるい、 <strong>勝手につけてほしい。</strong></li>
<li>dump, restore も可能な限り楽にやりたい。</li>
</ul>

<p>こんな感じで、後はオプション指定で別のデータベースとか指定できたらいいなあとか、
配布もさくっとできたらいいなあとか、
（僕は使わないけど）Windows とかでも使えたらいいなあとか、
他にも様々ありますが、必要な項目としては上の4つです。</p>

<p>するともう自然とコマンド名は <code>db</code> に決まり、
コマンドラインを作るのに今適してそうな Golang で書くのに決めました。
（というか先に Golang で書くことだけは決まっていた気がする）</p>

<h2 id="インストール">インストール</h2>

<p><strong>先にDocker あるいは Docker for Mac/Windows を入れましょう。</strong></p>

<p>その後 MacOS であれば</p>

<pre><code>$ brew tap girigiribauer/db-cli

$ brew install db-cli
</code></pre>

<p>でインストールできます。
（Homebrew 対応の話はまた別にメモっておきます）</p>

<p>バイナリファイルが直接欲しい人は
<a href="https://github.com/girigiribauer/db-cli/releases" target="_blank">https://github.com/girigiribauer/db-cli/releases</a> にあります。</p>

<h2 id="使い方">使い方</h2>

<p>基本的にヘルプに全部書いてありますのでお読みください。</p>

<p>以下は <a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a> と同じ内容です。</p>

<h3 id="データベース作る">データベース作る</h3>

<pre><code>$ db
</code></pre>

<p>これだけで DB が立ち上がった状態になります。
MariaDB をイメージとした &ldquo;db0&rdquo; という名前のコンテナが起動状態になっていて、
通常利用するであろう 3306 ポートが空いていれば、その番号がそのままポートフォワーディングされます。</p>

<p>試しにもう1回 <code>db</code> と打てばわかりますが、名前が空いていなければ &ldquo;db1&rdquo;, &ldquo;db2&rdquo; と繰り上がり、
3306 ポートが空いていなければ自動で割り当てられます。</p>

<p>なので、 <strong>1つだけ使って消す、使って消す、みたいな使い方をしていれば、
名前は必ず &ldquo;db0&rdquo; になり、ポートは 3306 になります。</strong>
（実際僕の利用用途の9割くらいはこれで満たされてます）</p>

<p>データベース名は何もつけなければ &ldquo;db&rdquo; です。
ユーザー名もパスワードも初期値 &ldquo;db&rdquo; です。</p>

<h3 id="データベース消す">データベース消す</h3>

<pre><code>$ db -d
</code></pre>

<p><strong>消すのも合計6ストロークです。</strong> けっこう短くないですか？</p>

<p>これも上と同様で、&rdquo;db0&rdquo; があればそれが消えます。なければ &ldquo;db1&rdquo;, &ldquo;db2&rdquo; を探しにいきます。</p>

<h3 id="その他">その他</h3>

<p>オプション以外の設定項目も、一通り <strong>環境変数で上書きできるようになっています。</strong></p>

<p>例えば .bashrc などに</p>

<pre><code>DBCLI_CONTAINER_PREFIX=go
</code></pre>

<p>などと書いておけば、勝手に go0, go1 &hellip; という名前のコンテナが立ち上がります。</p>

<p>dump, restore もできるので、 <a href="https://github.com/girigiribauer/db-cli" target="_blank">https://github.com/girigiribauer/db-cli</a> をお読みください。</p>

<h2 id="まだ微妙なところ">まだ微妙なところ</h2>

<p>TODO というわけではないのですが、うーん・・・と思ってるところが若干あります。
ただ自分用のコマンドを単に見えるようにしただけなので、
正直対応するかどうかは微妙です。</p>

<ul>
<li>Docker コンテナのヘルスチェック</li>
<li>test</li>
<li>PostgreSQL 対応</li>
</ul>

<h3 id="docker-コンテナのヘルスチェック">Docker コンテナのヘルスチェック</h3>

<p>正直なところ、Docker 1.12 あたりで導入された、
コンテナのヘルスチェック周りの知見がちょっと足らないかもです・・・。</p>

<p>この辺いじりだしたのは restore オプションの導入あたりからなのですが、
<code>db</code>, <code>db -d</code> コマンドだけ使っていれば、
ヘルスチェックなどはそもそも不要でした。（create -&gt; start するだけで問題ない）</p>

<p>restore オプションを実装するには、
コンテナを作るときにボリュームをマウントするなどの必要があったのですが、
あまり複雑なことをやりたくなかったので、
データベースが完全に用意できてから dump と同じ要領で <strong>外部からのコマンドを流し込む方法</strong> をとりました。</p>

<p>なお、今回は <strong>ボリュームのマウント機能は一切利用せずにコマンド作ってます。</strong>
ボリュームのマウントまで考慮に入れてしまうと、
じゃあローカルのどのディレクトリをマウント設定するんだとか、
そのオプションがなかった場合にどのような挙動になるんだとか、
色々（オペレーション的に）複雑になりすぎる気がしてたので
ボリュームを一切使わない方法はないか検討しました。</p>

<p>で、この <strong>データベースが完全に用意できてから</strong> というのが曲者で、
MariaDB が使えるようになるまで待機するのがどこまでなのかが未だによくわかっておりません・・・。</p>

<p><strong>mysqladmin の ping が通り始めるタイミング</strong> なのか、
あるいは <strong>&rdquo;/var/run/mysqld/mysqld.sock&rdquo; のファイルができるタイミング</strong> なのか、
いずれにしてもタイミングによって restore ができるときとできないときが出てきてしまうので、
5秒程度余分に待つといったダサい策をとってます。ぐぬぬ。</p>

<p>なのでもうちょっと Docker のヘルスチェックというか、
Docker を利用した MariaDB の起動の仕組みについてもう一段掘り下げてきちんと調べる必要がありそうですが、
正直そこまでコストかけるかどうか微妙なところです。</p>

<h3 id="test">test</h3>

<p>今回は API を叩くのがほとんどで、大きく DockerClient の状態に依存するので、
正直なところあまり頑張らずに DockerClient のエラーなどをそのまま垂れ流してもいいかなと思い、
あまり力を入れてません。</p>

<p>最初はイメージダウンロードしてコンテナ作った状態を再現してから、ってやってたんですが、
僕のストレスが増加しそうだったのでやめました。</p>

<h3 id="postgresql-対応">PostgreSQL 対応</h3>

<p>めんどかったので入れませんでした。
気が向いたら入れるかも。</p>

<p>一応ある程度楽には入れられるような作りにはなってます。</p>

<p>ただこれもヘルスチェックどうするんだ的な話が絡んでくるので、
気が向いたとしてもすぐ飽きるかもしれません。</p>

<h2 id="逆に思ったよりもよくできたところ-割り切ったところ">逆に思ったよりもよくできたところ、割り切ったところ</h2>

<ul>
<li>マルチプラットフォーム対応</li>
<li>そもそもの利用用途</li>
</ul>

<h3 id="マルチプラットフォーム対応">マルチプラットフォーム対応</h3>

<p>Golang のマルチプラットフォーム対応、なめてました。</p>

<pre><code>GOOS=windows GOARCH=amd64 go build -o build/windows-amd64/db.exe cmd/db/*.go
</code></pre>

<p><code>go build</code> コマンドの前に <code>GOOS</code> と <code>GOARCH</code> 環境変数をセットしてやるだけで
<strong>本当に Windows 用のバイナリが出来てしまいました。</strong></p>

<p>僕が使うわけではないので、あわよくば Windows 対応もできればいいなあくらいに思っていたのですが、
<strong>正直そんな手間もかからず（ゼロではないですが）対応できた</strong> のはありがたかったです。Golang マジすげえな。</p>

<p>ちょっと違うところといえば、
裏側で Docker Remote API を用いているのですが、
DockerClient のエンドポイントが Linux, MacOS は UNIX ドメインソケットなのに対して、
Windows では名前付きパイプ（npipe?）なんですよね。</p>

<p>ただこれも、大元のライブラリが普通に対応していて
パスの違いを吸収する程度の手間だったので
「まあこれくらいなら・・・」と思わせてくれるのは良いですね。</p>

<p>ちなみにこの DockerClient ライブラリに大きくお世話になりました。</p>

<p><a href="https://github.com/fsouza/go-dockerclient" target="_blank">https://github.com/fsouza/go-dockerclient</a></p>

<p><code>docker</code> コマンドで一通りできることは問題無くできると思います。</p>

<h3 id="そもそもの利用用途">そもそもの利用用途</h3>

<p>あまり大事にしたくなかったというか、試しに構築してみたいくらいの温度感だったので、
<strong>僕が使うプラスアルファの対応に留めたい</strong> と最初から思っていました。</p>

<p>なので、そもそも開発用としてローカルで使うもの前提だし、
レプリケーションやら dump 時のテーブルロックの話などはばっさり切り捨てています。</p>

<h2 id="まとめ">まとめ</h2>

<p>自分でコマンドを作ることは無くは無かったのですが、
表に出すところまではやったことがなかったので良い経験になりました。
Homebrew 対応についてはまた改めてメモっておきます。</p>

<p>Golang はクロスプラットフォームな CLI を作るのに適していると思います。</p>

<p>最後の方はみんなのGo言語も読みつつ進めていましたが、
ちょうど今回に合った話もちらほらあって読んでてとてもためになりました。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://godoc.org/github.com/fsouza/go-dockerclient" target="_blank">https://godoc.org/github.com/fsouza/go-dockerclient</a></li>
<li><a href="http://dev.classmethod.jp/cloud/aws/docker-healthcheck/" target="_blank">http://dev.classmethod.jp/cloud/aws/docker-healthcheck/</a></li>
<li><a href="https://suin.io/538" target="_blank">https://suin.io/538</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年10月3日">2016年10月3日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/golang/">Golang</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/cli/">CLI</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年9月29日">2016年9月29日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/virtualization/">Virtualization</a></li>
  </ul>
</div>




<p>最初失敗したので、同じところではまるであろう人のためにメモっておきます。
（念のため言っておきますが僕ははまったわけではないです・・・）</p>

<p>そもそも Windows 10 検証用のために VMWare Fusion をインストールしているのですが、
Mac で Docker を使いたいだけなら、
<a href="https://docs.docker.com/engine/installation/mac/" target="_blank">Docker for Mac</a>を
インストールするだけで問題ありません。
（仮想レイヤーが増えるだけで全くおすすめできない）</p>

<p>僕の場合は、Docker for Windows で検証したいことがあったため、
Windows Update 中に（よくないけど）マシンが空いてたので入れてみようと思い、
インストールしたはいいものの、以下のような画面になりました。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion01.png" alt="" /></p>

<p>困り顔・・・。（このキャラクターの名前ってあるんですかね？）</p>

<h2 id="docker-for-mac-windows-の動作の仕組み">Docker for Mac/Windows の動作の仕組み</h2>

<p>仕組みといっても、そこまで詳しいことは書けないのですが、
Docker は前提として <strong>Linux のコンテナ技術を用いているので、
Linux なしに動作させることはできません。</strong></p>

<p>Docker for Mac/Windows の1つ前のバージョンである Docker Toolbox では、
VirtualBox を利用することで仮想 OS のうすーい Linux を手元に作り、
そこの上に Docker コンテナを作ることで利用できてました。</p>

<p>Docker for Mac/Windows になってもそれは同様で、
ホスト型の VirtualBox を利用する代わりに、
Mac であれば <strong>xhyve</strong> というハイパーバイザー型の仮想化技術を、
Windows であれば <strong>Hyper-V</strong> というハイパーバイザー型の仮想化技術を
それぞれ利用して超うすい Linux を作り、その上で Docker を動作させてます。</p>

<p>そもそも、Docker for Windows の動作要件として、
<a href="https://docs.docker.com/docker-for-windows/" target="_blank">https://docs.docker.com/docker-for-windows/</a> のページに
こんなことが書いてあります。（2016/09/29 時点）</p>

<pre><code>The Hyper-V package must be enabled for Docker for Windows to work. The Docker for Windows installer will enable it for you, if needed. (This requires a reboot).
</code></pre>

<p>ということで、VMWare Fusion で Docker for Windows を利用したい人は、
結局のところ <strong>VMWare Fusion で Hyper-V を有効にしましょう</strong>、
というところに帰着します。</p>

<h2 id="docker-for-windows-のインストール">Docker for Windows のインストール</h2>

<p><a href="http://itnews.jp/?p=9332" target="_blank">VMware Fusion上のWindows10にHyper-Vを構成する。</a> を
少し参考にしています。</p>

<p>&ldquo;プロセッサとメモリ&rdquo; のメニューを選択します。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion02.png" alt="" /></p>

<p>その中に &ldquo;この仮想マシンでハイパーバイザー アプリケーションを有効にする&rdquo; というチェックボックスがあるのでチェックを入れます。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion03.png" alt="" /></p>

<p>基本的にはこれで完了です。</p>

<p>ただ、仮想 OS の上でさらに仮想環境をいじることになるので、
メモリが足らなくなるケースが出てくるかと思います。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion04.png" alt="" /></p>

<p>メモリだけは大量に積んであるので、推奨の倍まで増やしてやりました。
たぶん Docker for Windows も、初期設定のままであれば 2048MB のメモリ設定になっているかと思います。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion05.png" alt="" /></p>

<p>その後再度起動してみて、しばらくすると Docker is running の通知が。</p>

<p>Settings から確認してみると &ldquo;Docker is running&rdquo; の文字を確認することができました。</p>

<p><img src="/img/2016/09/docker_for_windows_on_vmware_fusion06.png" alt="" /></p>

<h2 id="まとめ">まとめ</h2>

<p>使うからには、最低限どういう原理で動作しているか、くらいは
押さえておいた方がいいかもしれません。</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年9月29日">2016年9月29日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/virtualization/">Virtualization</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2016年9月7日">2016年9月7日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
  </ul>
</div>




<p><a href="http://girigiribauer.com/archives/20160906/" target="_blank">Ansible で再起動後にも playbook を継続する方法</a> で
再ログインに関しても一緒にまとめておこうと思ったのですが、
Docker の方が話の割合として多くなりそうだったので別記事でまとめておきます。
特に Ansible で Docker をインストールするときはこれに該当するんじゃないかと思います。</p>

<h2 id="ansible-で-docker">Ansible で Docker</h2>

<p>まず話がややこしくならないように事前に触れておきますが、
Ansible &amp; Docker の話は複数あって、</p>

<ol>
<li>Ansible の playbook の実行（の検証？）に Docker コンテナを用いる話</li>
<li>Ansible の playbook で Docker をインストールする話</li>
</ol>

<p>が挙げられますが、今回は 1 ではなく 2 の話です。</p>

<p>ちなみに 1 についてですが、
例えばローカルに用意した VirtualBox や外部に借りている VPS の環境だったり、
SSH がつながる環境であれば Ansible の実行は可能ですが、
それが Docker コンテナまで利用できるように広がってきたよという話です。
（僕も詳しくないのでここまでしか把握してません。）</p>

<p>詳しくは &ldquo;ansible docker connection plugin&rdquo; でおググりください。</p>

<h2 id="docker-インストール時のグループ追加について">Docker インストール時のグループ追加について</h2>

<p>手動でやっててけっこうはまった箇所なのですが、
<strong>各種 docker コマンドを実行する際は、sudo をつけて実行するか、
docker グループにユーザーを追加してから docker コマンドを実行する必要があります。</strong></p>

<p>Ansible 実行ユーザーを docker グループに追加し Docker 関連の操作をさせる際に、
Ansible の playbook を Ansible 実行ユーザー自身が実行中なため、
<strong>一度ログインし直してグループに追加したことを設定反映する必要があります。</strong></p>

<p>つまり、Docker インストール用の playbook を実行して、
ansible ユーザーを docker グループに入れたからといって、
docker_image, docker_container モジュールを用いた playbook は動作しません。</p>

<p>予め手動で ansible ユーザーを docker グループに入れた直後にログアウトせず、
そのまま <code>docker ps</code> などを実行してみると、</p>

<pre><code>$ sudo usermod -aG docker ansible
$ docker ps
Cannot connect to the Docker daemon. Is the docker daemon running on this host?
</code></pre>

<p>というメッセージが出て Docker 周りの操作は何もできません。
（id -a などでグループに追加されているか確認しても、自分自身はログアウトしない限り追加されてません）</p>

<h2 id="docker-インストール用-playbook">Docker インストール用 playbook</h2>

<p>Ansible 実行ユーザー（ここでは ansible）を
docker グループに入れたまま docker コマンドが操作できる playbook を書いてみました。</p>

<p>仕組みとしては前回の <a href="http://girigiribauer.com/archives/20160906/" target="_blank">Ansible で再起動後にも playbook を継続する方法</a> と同じで
local_action を用いてログアウト後に待機します。</p>

<p>またまた抜粋ですみません・・・。改めてまとめなおします。</p>

<pre><code>- name: Docker 用 yum リポジトリの追加
  yum_repository:
    name: dockerrepo
    description: Docker Repository
    baseurl: https://yum.dockerproject.org/repo/main/centos/$releasever/
    enabled: yes
    gpgkey: https://yum.dockerproject.org/gpg
    gpgcheck: yes
  tags: dockerhost
  become: True

- name: docker-engine のインストール
  yum: name=docker-engine enablerepo=dockerrepo state=latest
  tags: dockerhost
  become: True

- name: docker-python のインストール
  yum: name=docker-python enablerepo=dockerrepo state=latest
  tags: dockerhost
  become: True

- name: Docker 起動時の DNS 設定
  copy: src=&quot;docker&quot; dest=&quot;/etc/sysconfig/docker&quot; owner=ansible group=ansible mode=0400
  tags: dockerhost
  become: True

- name: Docker サービス自動起動設定
  service: name=docker state=running enabled=True
  tags: dockerhost
  become: True

- name: Docker グループにユーザー追加
  user: name=ansible groups=docker append=yes
  tags: dockerhost
  become: True

- name: Ansible 実行ユーザー自身のグループ状況の取得
  shell: id -a
  register: group_status
  changed_when: False
  tags: dockerhost

- name: Docker グループ追加後の再ログイン
  shell: &quot;sleep 2 &amp;&amp; pkill -u ansible sshd&quot;
  async: 1
  poll: 0
  when: group_status.stdout.find('docker') == -1
  tags: dockerhost
  become: True

- name: Docker グループ追加後の再ログイン完了まで待機
  local_action: wait_for host={{ inventory_hostname }} port={{ ssh_port }} delay=10
  when: group_status.stdout.find('docker') == -1
  tags: dockerhost
  become: False

- name: Docker コマンドが Ansible 実行ユーザーで使えるかテスト
  shell: docker version
  changed_when: False
  tags: dockerhost
  become: False
</code></pre>

<p>docker-python と python-docker-py は多分同じパッケージなんじゃないかと思われます。
yum info を見てみると、どちらも docker が提供してるので、
単に <code>yum install docker</code> でインストールして入るであろう docker-python の方を指定しています。
（Ansible のドキュメントには docker-py が必要とありましたが、docker-python で問題なかったです）</p>

<pre><code>$ yum info docker-python
読み込んだプラグイン:fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.nus.edu.sg
 * extras: mirror.vodien.com
 * updates: mirror.vastspace.net
利用可能なパッケージ
名前                : docker-python
アーキテクチャー    : x86_64
バージョン          : 1.4.0
リリース            : 115.el7
容量                : 94 k
リポジトリー        : extras/7/x86_64
要約                : An API client for docker written in Python
URL                 : http://www.docker.com
ライセンス          : ASL 2.0
説明                : An API client for docker written in Python

$ yum info python-docker-py
読み込んだプラグイン:fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.nus.edu.sg
 * extras: mirror.vodien.com
 * updates: mirror.vastspace.net
インストール済みパッケージ
名前                : python-docker-py
アーキテクチャー    : noarch
バージョン          : 1.7.2
リリース            : 1.el7
容量                : 235 k
リポジトリー        : installed
提供元リポジトリー  : extras
要約                : An API client for docker written in Python
URL                 : https://github.com/docker/docker-py/
ライセンス          : ASL 2.0
説明                : An API client for docker written in Python
</code></pre>

<p>前回と同様に、実行するかどうかのステータスを取得して、
必要なければスキップするようになっています。</p>

<p>また、local_action と wait_for モジュールの組み合わせで再度 ssh でつなぎにいくのを待機しつつ検知しています。
最後の <code>docker version</code> では、実際にコマンドが有効かどうかを実行して確かめています。
仕組みとしては大きく前回と違いはありません。</p>

<h2 id="まとめ">まとめ</h2>

<p>まだ Docker ホストとして動作するまでしか用意してないので、
アプリケーションなどは特に動いてませんが、
開発用途であれ、サービス用途であれ、
これからはコンテナを中心とした環境にかなり移行していくと思うので、
<strong>Docker ホストとして最低限動作するところまでは playbook として共通化できる</strong> と思います。</p>

<p>ここまでやっておくと残りは Docker イメージや Docker コンテナの操作が中心になってきますね。</p>

<p>まだ、playbook は現時点でごちゃごちゃせずにすっきりしている（と個人的には思っている）ので、
docker-compose を導入せずにこのまま Ansible で Docker の構成管理してもいいんじゃないかとも思っています。</p>

<p>ちなみに、言うまでも無いことですが、
手動でセットアップできないのに Docker や Ansible を使えば知識なしに出来るわけはないので、
まずは空っぽの環境を用意して手動でやってみることをお勧めします。</p>

<h2 id="ref">参考URL</h2>

<ul>
<li><a href="https://docs.docker.com/engine/installation/linux/centos/" target="_blank">https://docs.docker.com/engine/installation/linux/centos/</a></li>
<li><a href="https://docs.ansible.com/ansible/docker_container_module.html" target="_blank">https://docs.ansible.com/ansible/docker_container_module.html</a></li>
<li><a href="https://github.com/ansible/ansible-modules-core/issues/921" target="_blank">https://github.com/ansible/ansible-modules-core/issues/921</a></li>
</ul>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2016年9月7日">2016年9月7日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/ansible/">Ansible</a></li>
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>

<div class="poststatus">
  <p>  <time datetime="2015年8月6日">2015年8月6日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/vagrant/">Vagrant</a></li>
  </ul>
</div>




<p>そもそも比較するようなものではないものの、分かりづらい解説しかなかったので、 超個人的な主観でまとめておこうと思いました。</p>

<h2 id="docker-の特徴">Docker の特徴</h2>

<ul>
<li>Linux 上でのみ動く (Windows, Mac 上では動かない)</li>
<li>Linux のリソースを流用しつつも小さく閉じた環境を作ることができる</li>
<li>小さいので作っては捨て、が容易</li>
</ul>

<p>例えるなら・・・</p>

<ul>
<li>病院の中に超小型隔離施設を作るようなもの</li>
<li>隔離されてるものの、診察も受けられるし隔離施設ごとトイレにも行ける</li>
<li>Docker コンテナをたくさん作る ≒ 病院内に超小型隔離患者がたくさん、みたいなイメージ</li>
</ul>

<h2 id="vagrant-の特徴">Vagrant の特徴</h2>

<ul>
<li>Windows / Mac / Linux それぞれにパッケージが用意されている</li>
<li>実際は VirtualBox や VMWare のような仮想環境を提供してくれるものとセットで使う</li>
<li>仮想環境としての Linux は、普通にインストールした Linux とほぼ変わらない構成</li>
</ul>

<p>例えるなら・・・</p>

<ul>
<li>病院の敷地の中に病院を建てるようなもの</li>
<li>内側の病院も、普通に診察できるし手術もできるし遜色なく利用できちゃう</li>
<li>Vagrant で VM たくさん作る ≒ 外側の病院敷地内に中小病院をたくさん建てる、みたいなイメージ</li>
<li>複数建てるときは資金力がいる</li>
</ul>

<hr />

<p>Mac で Docker いじるってことは、超軽量な Linux を boot2docker とかでインストールして、その上で動いているケースが多く（あるいは他 VM を立ち上げてるとか）、結局 Docker は Linux 上でのみ動くってことになります。（今後 Windows 方面がサポートするかもしれないけど）</p>

<p>たぶん本番環境の検証という意味では、Vagrant + Chef で本番環境にできるだけ近しい状態を構築して検証とかすべきなんですけど、開発環境をいくつも立ち上げては消しみたいなことをやりたいんだったら、Docker の方が軽くて良いのでは？と思っているところです。</p>

<p>もし本番環境に Docker を入れて色々利用したいのなら、まずは Vagrant + Chef の環境を手元に作って、Chef のレシピで Docker の環境を整えるレシピを書けばいいんだろうか。（まだその辺りはすっきりしてませんのでこれからですかね・・・）</p>


<ul class="socialbuttons">
  <li class="flow">
    <a href="https://twitter.com/share" class="twitter-share-button" data-lang="ja" data-count="vertical">Tweet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
  </li>
  <li class="flow">
    <div class="fb-like" data-layout="button" data-action="like" data-size="small" data-show-faces="false" data-share="false"></div>
  </li>
  <li class="flow">
    <a href="http://b.hatena.ne.jp/entry/" class="hatena-bookmark-button" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="en" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
  </li>
</ul>

<div class="poststatus">
  <p>  <time datetime="2015年8月6日">2015年8月6日</time>
</p>

  <ul class="tags">
    <li class="flow"><a href="/tags/docker/">Docker</a></li>
    <li class="flow"><a href="/tags/vagrant/">Vagrant</a></li>
  </ul>
</div>

<small>もし記事内に誤りなどございましたら、 <a href="https://twitter.com/girigiribauer" target="_blank">@girigiribauer</a> までご一報いただけると助かります。</small>







</div>

<footer>

<h2>Tags</h2>

<ul class="tags">
  <li class="flow">
    <a href="/tags/ansible">Ansible (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/apache">Apache (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cli">CLI (10)</a>
  </li>
  <li class="flow">
    <a href="/tags/css">CSS (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/css3">CSS3 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/cssfilter">CSSfilter (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/canvas">Canvas (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/chef">Chef (9)</a>
  </li>
  <li class="flow">
    <a href="/tags/crawler">Crawler (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/dom">DOM (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/docker">Docker (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/ftp">FTP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/font">Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/functionallanguage">FunctionalLanguage (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/glsl">GLSL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/git">Git (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/golang">Golang (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/html">HTML (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5">HTML5 (7)</a>
  </li>
  <li class="flow">
    <a href="/tags/html5-outline">HTML5-outline (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/homebrew">Homebrew (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/hugo">Hugo (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/icon-font">Icon-Font (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/javascript">JavaScript (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/linux">Linux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/mvc">MVC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/opengraph">OpenGraph (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/php">PHP (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rdfa">RDFa (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ssh">SSH (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/svg">SVG (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/scala">Scala (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/shellscript">ShellScript (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/smartphone">Smartphone (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/static-site-generator">Static Site Generator (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vagrant">Vagrant (15)</a>
  </li>
  <li class="flow">
    <a href="/tags/vim">Vim (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualbox">VirtualBox (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">Virtualization (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webapp">WebApp (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webaudioapi">WebAudioAPI (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webfont">WebFont (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webgl">WebGL (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webrtc">WebRTC (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/webserver">WebServer (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/yeoman">Yeoman (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/zsh">Zsh (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/ajax">ajax (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/automation">automation (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/bugs">bugs (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/event-conference">event-conference (5)</a>
  </li>
  <li class="flow">
    <a href="/tags/getusermedia">getUserMedia (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/gitconfig">gitconfig (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/ios">iOS (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/iterm">iTerm (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jquery">jQuery (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/jinja2">jinja2 (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jq">jq (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/jsperf">jsperf (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/lint">lint (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/mediaquery">mediaQuery (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/namespace">namespace (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/oldie">oldIE (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/output">output (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/polyfills">polyfills (4)</a>
  </li>
  <li class="flow">
    <a href="/tags/preloader">preloader (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/rsync">rsync (1)</a>
  </li>
  <li class="flow">
    <a href="/tags/tmux">tmux (3)</a>
  </li>
  <li class="flow">
    <a href="/tags/viewport">viewport (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/vimrc">vimrc (2)</a>
  </li>
  <li class="flow">
    <a href="/tags/virtualization">virtualization (6)</a>
  </li>
  <li class="flow">
    <a href="/tags/wget">wget (1)</a>
  </li>
</ul>

<h2>Categories</h2>

<ul>
  <li>
    <a href="/categories/tech/">Category / Tech</a>
  </li>
  <li>
    <a href="/categories/twentyfour/">Category / TwentyFour</a>
  </li>
</ul>

<h2>RSS</h2>

<ul>
  <li>
    <a href="/categories/tech/index.xml" target="_blank">RSS: Category / Tech</a>
  </li>
  <li>
    <a href="/index.xml" target="_blank">RSS: All articles</a>
  </li>
</ul>

<p>このブログは個人の見解であり、所属する組織の公式見解ではありません</p>
<p>&copy; ばうあーろぐ Generated by <a href="https://gohugo.io/" target="_blank">Hugo</a> and <a href="https://github.com/sindresorhus/github-markdown-css" target="_blank">github-markdown-css</a></p>

</footer>

</div>


<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-36767095-1']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>



  </body>
</html>


